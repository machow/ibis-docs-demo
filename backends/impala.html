<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>. - Impala</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">.</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../backends/index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Backends</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../reference/index.html" rel="" target="">
 <span class="menu-text">Reference</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../backends/impala.html">Impala</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../backends/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Backends</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../backends/dask.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dask</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../backends/impala.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Impala</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#impala" id="toc-impala" class="nav-link active" data-scroll-target="#impala">Impala</a>
  <ul class="collapse">
  <li><a href="#install" id="toc-install" class="nav-link" data-scroll-target="#install">Install</a></li>
  <li><a href="#connect" id="toc-connect" class="nav-link" data-scroll-target="#connect">Connect</a>
  <ul class="collapse">
  <li><a href="#api" id="toc-api" class="nav-link" data-scroll-target="#api">API</a></li>
  <li><a href="#connection-parameters" id="toc-connection-parameters" class="nav-link" data-scroll-target="#connection-parameters">Connection Parameters</a></li>
  <li><a href="#ibis.backends.impala.Backend.do_connect" id="toc-ibis.backends.impala.Backend.do_connect" class="nav-link" data-scroll-target="#ibis.backends.impala.Backend.do_connect">ibis.backends.impala.Backend.do_connect</a></li>
  </ul></li>
  <li><a href="#database-methods" id="toc-database-methods" class="nav-link" data-scroll-target="#database-methods">Database methods</a>
  <ul class="collapse">
  <li><a href="#ibis.backends.impala.Backend" id="toc-ibis.backends.impala.Backend" class="nav-link" data-scroll-target="#ibis.backends.impala.Backend">ibis.backends.impala.Backend</a></li>
  </ul></li>
  <li><a href="#table-methods" id="toc-table-methods" class="nav-link" data-scroll-target="#table-methods">Table methods</a>
  <ul class="collapse">
  <li><a href="#ibis.backends.impala.Backend" id="toc-ibis.backends.impala.Backend" class="nav-link" data-scroll-target="#ibis.backends.impala.Backend">ibis.backends.impala.Backend</a></li>
  </ul></li>
  <li><a href="#creating-views" id="toc-creating-views" class="nav-link" data-scroll-target="#creating-views">Creating views</a></li>
  <li><a href="#accessing-data-formats-in-hdfs" id="toc-accessing-data-formats-in-hdfs" class="nav-link" data-scroll-target="#accessing-data-formats-in-hdfs">Accessing data formats in HDFS</a></li>
  <li><a href="#hdfs-interaction" id="toc-hdfs-interaction" class="nav-link" data-scroll-target="#hdfs-interaction">HDFS Interaction</a></li>
  <li><a href="#the-impala-client-object" id="toc-the-impala-client-object" class="nav-link" data-scroll-target="#the-impala-client-object">The Impala client object</a></li>
  <li><a href="#table-objects" id="toc-table-objects" class="nav-link" data-scroll-target="#table-objects">Table objects</a></li>
  <li><a href="#expression-execution" id="toc-expression-execution" class="nav-link" data-scroll-target="#expression-execution">Expression execution</a></li>
  <li><a href="#creating-tables" id="toc-creating-tables" class="nav-link" data-scroll-target="#creating-tables">Creating tables</a>
  <ul class="collapse">
  <li><a href="#creating-tables-from-a-table-expression" id="toc-creating-tables-from-a-table-expression" class="nav-link" data-scroll-target="#creating-tables-from-a-table-expression">Creating tables from a table expression</a></li>
  <li><a href="#creating-an-empty-table" id="toc-creating-an-empty-table" class="nav-link" data-scroll-target="#creating-an-empty-table">Creating an empty table</a></li>
  <li><a href="#creating-a-partitioned-table" id="toc-creating-a-partitioned-table" class="nav-link" data-scroll-target="#creating-a-partitioned-table">Creating a partitioned table</a></li>
  </ul></li>
  <li><a href="#partitioned-tables" id="toc-partitioned-tables" class="nav-link" data-scroll-target="#partitioned-tables">Partitioned tables</a></li>
  <li><a href="#inserting-data-into-tables" id="toc-inserting-data-into-tables" class="nav-link" data-scroll-target="#inserting-data-into-tables">Inserting data into tables</a></li>
  <li><a href="#managing-table-metadata" id="toc-managing-table-metadata" class="nav-link" data-scroll-target="#managing-table-metadata">Managing table metadata</a>
  <ul class="collapse">
  <li><a href="#detailed-table-metadata-describe-formatted" id="toc-detailed-table-metadata-describe-formatted" class="nav-link" data-scroll-target="#detailed-table-metadata-describe-formatted">Detailed table metadata: <code>DESCRIBE FORMATTED</code></a></li>
  <li><a href="#modifying-table-metadata" id="toc-modifying-table-metadata" class="nav-link" data-scroll-target="#modifying-table-metadata">Modifying table metadata</a></li>
  </ul></li>
  <li><a href="#table-statistics" id="toc-table-statistics" class="nav-link" data-scroll-target="#table-statistics">Table statistics</a>
  <ul class="collapse">
  <li><a href="#computing-table-and-partition-statistics" id="toc-computing-table-and-partition-statistics" class="nav-link" data-scroll-target="#computing-table-and-partition-statistics">Computing table and partition statistics</a></li>
  <li><a href="#seeing-table-and-column-statistics" id="toc-seeing-table-and-column-statistics" class="nav-link" data-scroll-target="#seeing-table-and-column-statistics">Seeing table and column statistics</a></li>
  <li><a href="#refresh-and-invalidate-metadata" id="toc-refresh-and-invalidate-metadata" class="nav-link" data-scroll-target="#refresh-and-invalidate-metadata"><code>REFRESH</code> and <code>INVALIDATE METADATA</code></a></li>
  </ul></li>
  <li><a href="#issuing-load-data-commands" id="toc-issuing-load-data-commands" class="nav-link" data-scroll-target="#issuing-load-data-commands">Issuing <code>LOAD DATA</code> commands</a></li>
  <li><a href="#parquet-and-other-session-options" id="toc-parquet-and-other-session-options" class="nav-link" data-scroll-target="#parquet-and-other-session-options">Parquet and other session options</a></li>
  <li><a href="#ingesting-data-from-pandas" id="toc-ingesting-data-from-pandas" class="nav-link" data-scroll-target="#ingesting-data-from-pandas">Ingesting data from pandas</a></li>
  <li><a href="#uploading-downloading-data-from-hdfs" id="toc-uploading-downloading-data-from-hdfs" class="nav-link" data-scroll-target="#uploading-downloading-data-from-hdfs">Uploading / downloading data from HDFS</a></li>
  <li><a href="#queries-on-parquet-avro-and-delimited-files-in-hdfs" id="toc-queries-on-parquet-avro-and-delimited-files-in-hdfs" class="nav-link" data-scroll-target="#queries-on-parquet-avro-and-delimited-files-in-hdfs">Queries on Parquet, Avro, and Delimited files in HDFS</a></li>
  <li><a href="#other-helper-functions-for-interacting-with-the-database" id="toc-other-helper-functions-for-interacting-with-the-database" class="nav-link" data-scroll-target="#other-helper-functions-for-interacting-with-the-database">Other helper functions for interacting with the database</a></li>
  <li><a href="#faster-queries-on-small-data-in-impala" id="toc-faster-queries-on-small-data-in-impala" class="nav-link" data-scroll-target="#faster-queries-on-small-data-in-impala">Faster queries on small data in Impala</a></li>
  <li><a href="#user-defined-functions-udf" id="toc-user-defined-functions-udf" class="nav-link" data-scroll-target="#user-defined-functions-udf">User Defined functions (UDF)</a>
  <ul class="collapse">
  <li><a href="#using-scalar-functions-udfs" id="toc-using-scalar-functions-udfs" class="nav-link" data-scroll-target="#using-scalar-functions-udfs">Using scalar functions (UDFs)</a></li>
  </ul></li>
  <li><a href="#working-with-secure-clusters-kerberos" id="toc-working-with-secure-clusters-kerberos" class="nav-link" data-scroll-target="#working-with-secure-clusters-kerberos">Working with secure clusters (Kerberos)</a></li>
  <li><a href="#default-configuration-values-for-cdh-components" id="toc-default-configuration-values-for-cdh-components" class="nav-link" data-scroll-target="#default-configuration-values-for-cdh-components">Default Configuration Values for CDH Components</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Impala</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="impala" class="level1">
<h1><a href="https://impala.apache.org/">Impala</a></h1>
<p>One goal of Ibis is to provide an integrated Python API for an Impala cluster without requiring you to switch back and forth between Python code and the Impala shell.</p>
<section id="install" class="level2">
<h2 class="anchored" data-anchor-id="install">Install</h2>
<p>Install <code>ibis</code> and dependencies for the Impala backend:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">pip</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">conda</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">mamba</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb1"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="st">'ibis-framework[impala]'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="sourceCode" id="cb2"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> install <span class="at">-c</span> conda-forge ibis-impala</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="sourceCode" id="cb3"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mamba</span> install <span class="at">-c</span> conda-forge ibis-impala</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="connect" class="level2">
<h2 class="anchored" data-anchor-id="connect">Connect</h2>
<section id="api" class="level3">
<h3 class="anchored" data-anchor-id="api">API</h3>
<p>Create a client by passing in connection parameters to <code>ibis.impala.connect</code>.</p>
<!-- prettier-ignore-start -->
<p>See [<code>ibis.backends.impala.Backend.do_connect</code>][ibis.backends.impala.None.do_connect] for connection parameter information. <!-- prettier-ignore-end --></p>
<!-- prettier-ignore-start -->
<p>!!! info “<code>ibis.impala.connect</code> is a thin wrapper around [<code>ibis.backends.impala.Backend.do_connect</code>][ibis.backends.impala.None.do_connect].” <!-- prettier-ignore-end --></p>
</section>
<section id="connection-parameters" class="level3">
<h3 class="anchored" data-anchor-id="connection-parameters">Connection Parameters</h3>
</section>
<section id="ibis.backends.impala.Backend.do_connect" class="level3">
<h3 class="anchored" data-anchor-id="ibis.backends.impala.Backend.do_connect">ibis.backends.impala.Backend.do_connect</h3>
<p><code>backends.impala.Backend.do_connect(self, host='localhost', port=21050, database='default', timeout=45, use_ssl=False, ca_cert=None, user=None, password=None, auth_mechanism='NOSASL', kerberos_service_name='impala', pool_size=8, hdfs_client=None)</code></p>
<p>Create an Impala Backend for use with Ibis.</p>
<section id="parameters" class="level4">
<h4 class="anchored" data-anchor-id="parameters">Parameters</h4>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 13%">
<col style="width: 76%">
<col style="width: 3%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>host</code></td>
<td>str</td>
<td>Host name of the impalad or HiveServer2 in Hive</td>
<td><code>'localhost'</code></td>
</tr>
<tr class="even">
<td><code>port</code></td>
<td>int</td>
<td>Impala’s HiveServer2 port</td>
<td><code>21050</code></td>
</tr>
<tr class="odd">
<td><code>database</code></td>
<td>str</td>
<td>Default database when obtaining new cursors</td>
<td><code>'default'</code></td>
</tr>
<tr class="even">
<td><code>timeout</code></td>
<td>int</td>
<td>Connection timeout in seconds when communicating with HiveServer2</td>
<td><code>45</code></td>
</tr>
<tr class="odd">
<td><code>use_ssl</code></td>
<td>bool</td>
<td>Use SSL when connecting to HiveServer2</td>
<td><code>False</code></td>
</tr>
<tr class="even">
<td><code>ca_cert</code></td>
<td>str | pathlib.Path | None</td>
<td>Local path to 3rd party CA certificate or copy of server certificate for self-signed certificates. If SSL is enabled, but this argument is <code>None</code>, then certificate validation is skipped.</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>user</code></td>
<td>str | None</td>
<td>LDAP user to authenticate</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>password</code></td>
<td>str | None</td>
<td>LDAP password to authenticate</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>auth_mechanism</code></td>
<td>typing.Literal[‘NOSASL’, ‘PLAIN’, ‘GSSAPI’, ‘LDAP’]</td>
<td>| Value | Meaning | | :——–: | :—————————– | | <code>'NOSASL'</code> | insecure Impala connections | | <code>'PLAIN'</code> | insecure Hive clusters | | <code>'LDAP'</code> | LDAP authenticated connections | | <code>'GSSAPI'</code> | Kerberos-secured clusters |</td>
<td><code>'NOSASL'</code></td>
</tr>
<tr class="even">
<td><code>kerberos_service_name</code></td>
<td>str</td>
<td>Specify a particular <code>impalad</code> service principal.</td>
<td><code>'impala'</code></td>
</tr>
<tr class="odd">
<td><code>pool_size</code></td>
<td>int</td>
<td>Size of the connection pool. Typically this is not necessary to configure.</td>
<td><code>8</code></td>
</tr>
<tr class="even">
<td><code>hdfs_client</code></td>
<td>fsspec.spec.AbstractFileSystem | None</td>
<td>An existing HDFS client.</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</section>
<section id="examples" class="level4">
<h4 class="anchored" data-anchor-id="examples">Examples</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> os</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> ibis</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> hdfs_host <span class="op">=</span> os.environ.get(<span class="st">'IBIS_TEST_NN_HOST'</span>, <span class="st">'localhost'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> hdfs_port <span class="op">=</span> <span class="bu">int</span>(os.environ.get(<span class="st">'IBIS_TEST_NN_PORT'</span>, <span class="dv">50070</span>))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> impala_host <span class="op">=</span> os.environ.get(<span class="st">'IBIS_TEST_IMPALA_HOST'</span>, <span class="st">'localhost'</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> impala_port <span class="op">=</span> <span class="bu">int</span>(os.environ.get(<span class="st">'IBIS_TEST_IMPALA_PORT'</span>, <span class="dv">21050</span>))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> hdfs <span class="op">=</span> ibis.impala.hdfs_connect(host<span class="op">=</span>hdfs_host, port<span class="op">=</span>hdfs_port)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> client <span class="op">=</span> ibis.impala.<span class="ex">connect</span>(</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>...     host<span class="op">=</span>impala_host,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>...     port<span class="op">=</span>impala_port,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>...     hdfs_client<span class="op">=</span>hdfs,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>... )</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> client</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>ibis.backends.impala.Backend <span class="bu">object</span> at <span class="dv">0</span><span class="er">x</span>...<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Both method calls can take <code>auth_mechanism='GSSAPI'</code> or <code>auth_mechanism='LDAP'</code> to connect to Kerberos clusters. Depending on your cluster setup, this may also include SSL. See the <code>API reference</code> for more, along with the Impala shell reference, as the connection semantics are identical.</p>
<p>These methods are available on the Impala client object after connecting to your HDFS cluster (<code>ibis.impala.hdfs_connect</code>) and connecting to Impala with <code>ibis.impala.connect</code>. See <code>backends.impala</code> for a tutorial on using this backend.</p>
</section>
</section>
</section>
<section id="database-methods" class="level2">
<h2 class="anchored" data-anchor-id="database-methods">Database methods</h2>
<section id="ibis.backends.impala.Backend" class="level3">
<h3 class="anchored" data-anchor-id="ibis.backends.impala.Backend">ibis.backends.impala.Backend</h3>
<p><code>backends.impala.Backend()</code></p>
<section id="methods" class="level4">
<h4 class="anchored" data-anchor-id="methods">Methods</h4>
<table class="table">
<thead>
<tr class="header">
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="#ibis.backends.impala.Backend.create_database">create_database</a></td>
<td>Create a new Impala database.</td>
</tr>
<tr class="even">
<td><a href="#ibis.backends.impala.Backend.drop_database">drop_database</a></td>
<td>Drop an Impala database.</td>
</tr>
<tr class="odd">
<td><a href="#ibis.backends.impala.Backend.list_databases">list_databases</a></td>
<td></td>
</tr>
</tbody>
</table>
<section id="ibis.backends.impala.Backend.create_database" class="level5">
<h5 class="anchored" data-anchor-id="ibis.backends.impala.Backend.create_database">create_database</h5>
<p><code>backends.impala.Backend.create_database(self, name, path=None, force=False)</code></p>
<p>Create a new Impala database.</p>
<section id="parameters-1" class="level6">
<h6 class="anchored" data-anchor-id="parameters-1">Parameters</h6>
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 72%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>name</code></td>
<td></td>
<td>Database name</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>path</code></td>
<td></td>
<td>HDFS path where to store the database data; otherwise uses Impala default</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>force</code></td>
<td></td>
<td>Forcibly create the database</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="ibis.backends.impala.Backend.drop_database" class="level5">
<h5 class="anchored" data-anchor-id="ibis.backends.impala.Backend.drop_database">drop_database</h5>
<p><code>backends.impala.Backend.drop_database(self, name, force=False)</code></p>
<p>Drop an Impala database.</p>
<section id="parameters-2" class="level6">
<h6 class="anchored" data-anchor-id="parameters-2">Parameters</h6>
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 72%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>name</code></td>
<td></td>
<td>Database name</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>force</code></td>
<td></td>
<td>If False and there are any tables in this database, raises an IntegrityError</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="ibis.backends.impala.Backend.list_databases" class="level5">
<h5 class="anchored" data-anchor-id="ibis.backends.impala.Backend.list_databases">list_databases</h5>
<p><code>backends.impala.Backend.list_databases(self, like=None)</code></p>
</section>
</section>
</section>
</section>
<section id="table-methods" class="level2">
<h2 class="anchored" data-anchor-id="table-methods">Table methods</h2>
<p>The <code>Backend</code> object itself has many helper utility methods. You’ll find the most methods on <code>ImpalaTable</code>.</p>
<section id="ibis.backends.impala.Backend" class="level3">
<h3 class="anchored" data-anchor-id="ibis.backends.impala.Backend">ibis.backends.impala.Backend</h3>
<p><code>backends.impala.Backend()</code></p>
<section id="methods-1" class="level4">
<h4 class="anchored" data-anchor-id="methods-1">Methods</h4>
<table class="table">
<thead>
<tr class="header">
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="#ibis.backends.impala.Backend.table">table</a></td>
<td></td>
</tr>
<tr class="even">
<td><a href="#ibis.backends.impala.Backend.sql">sql</a></td>
<td>Convert a SQL query to an Ibis table expression.</td>
</tr>
<tr class="odd">
<td><a href="#ibis.backends.impala.Backend.raw_sql">raw_sql</a></td>
<td>Execute a query string.</td>
</tr>
<tr class="even">
<td><a href="#ibis.backends.impala.Backend.list_tables">list_tables</a></td>
<td></td>
</tr>
<tr class="odd">
<td><a href="#ibis.backends.impala.Backend.drop_table">drop_table</a></td>
<td>Drop an Impala table.</td>
</tr>
<tr class="even">
<td><a href="#ibis.backends.impala.Backend.create_table">create_table</a></td>
<td>Create a new table in Impala using an Ibis table expression.</td>
</tr>
<tr class="odd">
<td><a href="#ibis.backends.impala.Backend.insert">insert</a></td>
<td>Insert data into an existing table.</td>
</tr>
<tr class="even">
<td><a href="#ibis.backends.impala.Backend.invalidate_metadata">invalidate_metadata</a></td>
<td>Issue an <code>INVALIDATE METADATA</code> command.</td>
</tr>
<tr class="odd">
<td><a href="#ibis.backends.impala.Backend.truncate_table">truncate_table</a></td>
<td>Delete all rows from an existing table.</td>
</tr>
<tr class="even">
<td><a href="#ibis.backends.impala.Backend.get_schema">get_schema</a></td>
<td>Return a Schema object for the indicated table and database.</td>
</tr>
<tr class="odd">
<td><a href="#ibis.backends.impala.Backend.cache_table">cache_table</a></td>
<td>Caches a table in cluster memory in the given pool.</td>
</tr>
<tr class="even">
<td><a href="#ibis.backends.impala.Backend.get_options">get_options</a></td>
<td>Return current query options for the Impala session.</td>
</tr>
<tr class="odd">
<td><a href="#ibis.backends.impala.Backend.set_options">set_options</a></td>
<td></td>
</tr>
<tr class="even">
<td><a href="#ibis.backends.impala.Backend.set_compression_codec">set_compression_codec</a></td>
<td></td>
</tr>
</tbody>
</table>
<section id="ibis.backends.impala.Backend.table" class="level5">
<h5 class="anchored" data-anchor-id="ibis.backends.impala.Backend.table">table</h5>
<p><code>backends.impala.Backend.table(self, name, database=None, **kwargs)</code></p>
</section>
<section id="ibis.backends.impala.Backend.sql" class="level5">
<h5 class="anchored" data-anchor-id="ibis.backends.impala.Backend.sql">sql</h5>
<p><code>backends.impala.Backend.sql(self, query, schema=None, dialect=None)</code></p>
<p>Convert a SQL query to an Ibis table expression.</p>
<section id="parameters-3" class="level6">
<h6 class="anchored" data-anchor-id="parameters-3">Parameters</h6>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 12%">
<col style="width: 73%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>query</code></td>
<td>str</td>
<td>SQL string</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>schema</code></td>
<td>ibis.Schema | None</td>
<td>The expected schema for this query. If not provided, will be inferred automatically if possible.</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>dialect</code></td>
<td>str | None</td>
<td>Optional string indicating the dialect of <code>query</code>. The default value of <code>None</code> will use the backend’s native dialect.</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns" class="level6">
<h6 class="anchored" data-anchor-id="returns">Returns</h6>
<table class="table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Table</td>
<td>Table expression</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="ibis.backends.impala.Backend.raw_sql" class="level5">
<h5 class="anchored" data-anchor-id="ibis.backends.impala.Backend.raw_sql">raw_sql</h5>
<p><code>backends.impala.Backend.raw_sql(self, query)</code></p>
<p>Execute a query string.</p>
<p>!!! warning “The returned cursor object must be <strong>manually</strong> released if results are returned.”</p>
<section id="parameters-4" class="level6">
<h6 class="anchored" data-anchor-id="parameters-4">Parameters</h6>
<table class="table">
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>query</code></td>
<td>str</td>
<td>DDL or DML statement</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="ibis.backends.impala.Backend.list_tables" class="level5">
<h5 class="anchored" data-anchor-id="ibis.backends.impala.Backend.list_tables">list_tables</h5>
<p><code>backends.impala.Backend.list_tables(self, like=None, database=None)</code></p>
</section>
<section id="ibis.backends.impala.Backend.drop_table" class="level5">
<h5 class="anchored" data-anchor-id="ibis.backends.impala.Backend.drop_table">drop_table</h5>
<p><code>backends.impala.Backend.drop_table(self, name, *, database=None, force=False)</code></p>
<p>Drop an Impala table.</p>
<section id="parameters-5" class="level6">
<h6 class="anchored" data-anchor-id="parameters-5">Parameters</h6>
<table class="table">
<colgroup>
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 59%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>name</code></td>
<td>str</td>
<td>Table name</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>database</code></td>
<td>str | None</td>
<td>Database name</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>force</code></td>
<td>bool</td>
<td>Database may throw exception if table does not exist</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</section>
<section id="examples-1" class="level6">
<h6 class="anchored" data-anchor-id="examples-1">Examples</h6>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> table <span class="op">=</span> <span class="st">'my_table'</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> db <span class="op">=</span> <span class="st">'operations'</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.drop_table(table, database<span class="op">=</span>db, force<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="ibis.backends.impala.Backend.create_table" class="level5">
<h5 class="anchored" data-anchor-id="ibis.backends.impala.Backend.create_table">create_table</h5>
<p><code>backends.impala.Backend.create_table(self, name, obj=None, *, schema=None, database=None, temp=None, overwrite=False, external=False, format='parquet', location=None, partition=None, like_parquet=None)</code></p>
<p>Create a new table in Impala using an Ibis table expression.</p>
<p>This is currently designed for tables whose data is stored in HDFS.</p>
<section id="parameters-6" class="level6">
<h6 class="anchored" data-anchor-id="parameters-6">Parameters</h6>
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 13%">
<col style="width: 66%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>name</code></td>
<td>str</td>
<td>Table name</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>obj</code></td>
<td>ibis.Table | None</td>
<td>If passed, creates table from select statement results</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>schema</code></td>
<td></td>
<td>Mutually exclusive with obj, creates an empty table with a particular schema</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>database</code></td>
<td></td>
<td>Database name</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>temp</code></td>
<td>bool | None</td>
<td>Whether a table is temporary</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>overwrite</code></td>
<td>bool</td>
<td>Do not create table if table with indicated name already exists</td>
<td><code>False</code></td>
</tr>
<tr class="odd">
<td><code>external</code></td>
<td>bool</td>
<td>Create an external table; Impala will not delete the underlying data when the table is dropped</td>
<td><code>False</code></td>
</tr>
<tr class="even">
<td><code>format</code></td>
<td></td>
<td>File format</td>
<td><code>'parquet'</code></td>
</tr>
<tr class="odd">
<td><code>location</code></td>
<td></td>
<td>Specify the directory location where Impala reads and writes files for the table</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>partition</code></td>
<td></td>
<td>Must pass a schema to use this. Cannot partition from an expression.</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>like_parquet</code></td>
<td></td>
<td>Can specify instead of a schema</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="ibis.backends.impala.Backend.insert" class="level5">
<h5 class="anchored" data-anchor-id="ibis.backends.impala.Backend.insert">insert</h5>
<p><code>backends.impala.Backend.insert(self, table_name, obj=None, database=None, overwrite=False, partition=None, values=None, validate=True)</code></p>
<p>Insert data into an existing table.</p>
<p>See [<code>ImpalaTable.insert</code>][ibis.backends.impala.client.ImpalaTable.insert] for parameters.</p>
<section id="examples-2" class="level6">
<h6 class="anchored" data-anchor-id="examples-2">Examples</h6>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> table <span class="op">=</span> <span class="st">'my_table'</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.insert(table, table_expr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Completely overwrite contents</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.insert(table, table_expr, overwrite<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="ibis.backends.impala.Backend.invalidate_metadata" class="level5">
<h5 class="anchored" data-anchor-id="ibis.backends.impala.Backend.invalidate_metadata">invalidate_metadata</h5>
<p><code>backends.impala.Backend.invalidate_metadata(self, name=None, database=None)</code></p>
<p>Issue an <code>INVALIDATE METADATA</code> command.</p>
<p>Optionally this applies to a specific table. See Impala documentation.</p>
<section id="parameters-7" class="level6">
<h6 class="anchored" data-anchor-id="parameters-7">Parameters</h6>
<table class="table">
<colgroup>
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 59%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>name</code></td>
<td>str | None</td>
<td>Table name. Can be fully qualified (with database)</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>database</code></td>
<td>str | None</td>
<td>Database name</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="ibis.backends.impala.Backend.truncate_table" class="level5">
<h5 class="anchored" data-anchor-id="ibis.backends.impala.Backend.truncate_table">truncate_table</h5>
<p><code>backends.impala.Backend.truncate_table(self, name, database=None)</code></p>
<p>Delete all rows from an existing table.</p>
<section id="parameters-8" class="level6">
<h6 class="anchored" data-anchor-id="parameters-8">Parameters</h6>
<table class="table">
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>name</code></td>
<td>str</td>
<td>Table name</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>database</code></td>
<td>str | None</td>
<td>Database name</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="ibis.backends.impala.Backend.get_schema" class="level5">
<h5 class="anchored" data-anchor-id="ibis.backends.impala.Backend.get_schema">get_schema</h5>
<p><code>backends.impala.Backend.get_schema(self, table_name, database=None)</code></p>
<p>Return a Schema object for the indicated table and database.</p>
<section id="parameters-9" class="level6">
<h6 class="anchored" data-anchor-id="parameters-9">Parameters</h6>
<table class="table">
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>table_name</code></td>
<td>str</td>
<td>Table name</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>database</code></td>
<td>str | None</td>
<td>Database name</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-1" class="level6">
<h6 class="anchored" data-anchor-id="returns-1">Returns</h6>
<table class="table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Schema</td>
<td>Ibis schema</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="ibis.backends.impala.Backend.cache_table" class="level5">
<h5 class="anchored" data-anchor-id="ibis.backends.impala.Backend.cache_table">cache_table</h5>
<p><code>backends.impala.Backend.cache_table(self, table_name, *, database=None, pool='default')</code></p>
<p>Caches a table in cluster memory in the given pool.</p>
<section id="parameters-10" class="level6">
<h6 class="anchored" data-anchor-id="parameters-10">Parameters</h6>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 9%">
<col style="width: 58%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>table_name</code></td>
<td></td>
<td>Table name</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>database</code></td>
<td></td>
<td>Database name</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>pool</code></td>
<td></td>
<td>The name of the pool in which to cache the table</td>
<td><code>'default'</code></td>
</tr>
</tbody>
</table>
</section>
<section id="examples-3" class="level6">
<h6 class="anchored" data-anchor-id="examples-3">Examples</h6>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> table <span class="op">=</span> <span class="st">'my_table'</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> db <span class="op">=</span> <span class="st">'operations'</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> pool <span class="op">=</span> <span class="st">'op_4GB_pool'</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.cache_table(<span class="st">'my_table'</span>, database<span class="op">=</span>db, pool<span class="op">=</span>pool)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="ibis.backends.impala.Backend.get_options" class="level5">
<h5 class="anchored" data-anchor-id="ibis.backends.impala.Backend.get_options">get_options</h5>
<p><code>backends.impala.Backend.get_options(self)</code></p>
<p>Return current query options for the Impala session.</p>
</section>
<section id="ibis.backends.impala.Backend.set_options" class="level5">
<h5 class="anchored" data-anchor-id="ibis.backends.impala.Backend.set_options">set_options</h5>
<p><code>backends.impala.Backend.set_options(self, options)</code></p>
</section>
<section id="ibis.backends.impala.Backend.set_compression_codec" class="level5">
<h5 class="anchored" data-anchor-id="ibis.backends.impala.Backend.set_compression_codec">set_compression_codec</h5>
<p><code>backends.impala.Backend.set_compression_codec(self, codec)</code></p>
<p>The best way to interact with a single table is through the <code>ImpalaTable</code> object you get back from <code>Backend.table</code>.</p>
<pre><code>&lt;!-- prettier-ignore-start --&gt;
::: ibis.backends.impala.client.ImpalaTable
    options:
      heading_level: 3
      members:
        - add_partition
        - alter
        - alter_partition
        - column_stats
        - compute_stats
        - describe_formatted
        - drop
        - drop_partition
        - files
        - insert
        - invalidate_metadata
        - is_partitioned
        - load_data
        - metadata
        - partition_schema
        - partitions
        - refresh
        - rename
        - schema
        - stats

&lt;!-- prettier-ignore-end --&gt;</code></pre>
</section>
</section>
</section>
</section>
<section id="creating-views" class="level2">
<h2 class="anchored" data-anchor-id="creating-views">Creating views</h2>
<pre><code>&lt;!-- prettier-ignore-start --&gt;
::: ibis.backends.impala.Backend
    options:
      heading_level: 3
      members:
        - drop_table_or_view
        - create_view

&lt;!-- prettier-ignore-end --&gt;</code></pre>
</section>
<section id="accessing-data-formats-in-hdfs" class="level2">
<h2 class="anchored" data-anchor-id="accessing-data-formats-in-hdfs">Accessing data formats in HDFS</h2>
<pre><code>&lt;!-- prettier-ignore-start --&gt;
::: ibis.backends.impala.Backend
    options:
      heading_level: 3
      members:
        - delimited_file
        - parquet_file
        - avro_file

&lt;!-- prettier-ignore-end --&gt;</code></pre>
</section>
<section id="hdfs-interaction" class="level2">
<h2 class="anchored" data-anchor-id="hdfs-interaction">HDFS Interaction</h2>
<p>Ibis delegates all HDFS interaction to the <a href="https://filesystem-spec.readthedocs.io/en/latest/"><code>fsspec</code></a> library.</p>
</section>
<section id="the-impala-client-object" class="level2">
<h2 class="anchored" data-anchor-id="the-impala-client-object">The Impala client object</h2>
<p>To use Ibis with Impala, you first must connect to a cluster using the <code>ibis.impala.connect</code> function, optionally supplying an HDFS connection:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ibis</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>hdfs <span class="op">=</span> ibis.impala.hdfs_connect(host<span class="op">=</span>webhdfs_host, port<span class="op">=</span>webhdfs_port)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> ibis.impala.<span class="ex">connect</span>(host<span class="op">=</span>impala_host, port<span class="op">=</span>impala_port, hdfs_client<span class="op">=</span>hdfs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>All examples here use the following block of code to connect to impala using docker:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ibis</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>hdfs <span class="op">=</span> ibis.impala.hdfs_connect(host<span class="op">=</span><span class="st">"localhost"</span>, port<span class="op">=</span><span class="dv">50070</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> ibis.impala.<span class="ex">connect</span>(host<span class="op">=</span>host, hdfs_client<span class="op">=</span>hdfs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can accomplish many tasks directly through the client object, but we additionally provide APIs to streamline tasks involving a single Impala table or database.</p>
</section>
<section id="table-objects" class="level2">
<h2 class="anchored" data-anchor-id="table-objects">Table objects</h2>
<pre><code>&lt;!-- prettier-ignore-start --&gt;
::: ibis.backends.base.sql.BaseSQLBackend.table
    options:
      heading_level: 3
&lt;!-- prettier-ignore-end --&gt;</code></pre>
<p>The client’s <code>table</code> method allows you to create an Ibis table expression referencing a physical Impala table:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> client.table(<span class="st">'functional_alltypes'</span>, database<span class="op">=</span><span class="st">'ibis_testing'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>ImpalaTable</code> is a Python subclass of the more general Ibis <code>Table</code> that has additional Impala-specific methods. So you can use it interchangeably with any code expecting a <code>Table</code>.</p>
<p>Like all table expressions in Ibis, <code>ImpalaTable</code> has a <code>schema</code> method you can use to examine its schema:</p>
<pre><code>&lt;!-- prettier-ignore-start --&gt;
::: ibis.backends.impala.client.ImpalaTable
    options:
      heading_level: 3
      members:
        - schema

&lt;!-- prettier-ignore-end --&gt;</code></pre>
<p>While the client has a <code>drop_table</code> method you can use to drop tables, the table itself has a method <code>drop</code> that you can use:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>table.drop()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="expression-execution" class="level2">
<h2 class="anchored" data-anchor-id="expression-execution">Expression execution</h2>
<p>Ibis expressions have execution methods like <code>to_pandas</code> that compile and run the expressions on Impala or whichever backend is being referenced.</p>
<p>For example:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> fa <span class="op">=</span> db.functional_alltypes</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> expr <span class="op">=</span> fa.double_col.<span class="bu">sum</span>()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> expr.to_pandas()</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fl">331785.00000000006</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For longer-running queries, Ibis will attempt to cancel the query in progress if an interrupt is received.</p>
</section>
<section id="creating-tables" class="level2">
<h2 class="anchored" data-anchor-id="creating-tables">Creating tables</h2>
<p>There are several ways to create new Impala tables:</p>
<ul>
<li>From an Ibis table expression</li>
<li>Empty, from a declared schema</li>
<li>Empty and partitioned</li>
</ul>
<p>In all cases, you should use the <code>create_table</code> method either on the top-level client connection or a database object.</p>
<pre><code>&lt;!-- prettier-ignore-start --&gt;
::: ibis.backends.impala.Backend.create_table
    options:
      heading_level: 3
&lt;!-- prettier-ignore-end --&gt;</code></pre>
<section id="creating-tables-from-a-table-expression" class="level3">
<h3 class="anchored" data-anchor-id="creating-tables-from-a-table-expression">Creating tables from a table expression</h3>
<p>If you pass an Ibis expression to <code>create_table</code>, Ibis issues a <code>CREATE TABLE ... AS SELECT</code> (CTAS) statement:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> table <span class="op">=</span> db.table(<span class="st">'functional_alltypes'</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> expr <span class="op">=</span> table.group_by(<span class="st">'string_col'</span>).size()</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> db.create_table(<span class="st">'string_freqs'</span>, expr, <span class="bu">format</span><span class="op">=</span><span class="st">'parquet'</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> freqs <span class="op">=</span> db.table(<span class="st">'string_freqs'</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> freqs.to_pandas()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  string_col  count</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>          <span class="dv">9</span>    <span class="dv">730</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>          <span class="dv">3</span>    <span class="dv">730</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>          <span class="dv">6</span>    <span class="dv">730</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>          <span class="dv">4</span>    <span class="dv">730</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>          <span class="dv">1</span>    <span class="dv">730</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>          <span class="dv">8</span>    <span class="dv">730</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>          <span class="dv">2</span>    <span class="dv">730</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>          <span class="dv">7</span>    <span class="dv">730</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>          <span class="dv">5</span>    <span class="dv">730</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>          <span class="dv">0</span>    <span class="dv">730</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> files <span class="op">=</span> freqs.files()</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> files</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>                                                Path  Size Partition</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  hdfs:<span class="op">//</span>impala:<span class="dv">8020</span><span class="op">/</span>user<span class="op">/</span>hive<span class="op">/</span>warehouse<span class="op">/</span>ibis_te...  <span class="dv">584</span><span class="er">B</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> freqs.drop()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can also choose to create an empty table and use <code>insert</code> (see below).</p>
</section>
<section id="creating-an-empty-table" class="level3">
<h3 class="anchored" data-anchor-id="creating-an-empty-table">Creating an empty table</h3>
<p>To create an empty table, you must declare an Ibis schema that will be translated to the appropriate Impala schema and data types.</p>
<p>As Ibis types are simplified compared with Impala types, this may expand in the future to include a more fine-grained schema declaration.</p>
<p>You can use the <code>create_table</code> method either on a database or client object.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>schema <span class="op">=</span> ibis.schema([(<span class="st">'foo'</span>, <span class="st">'string'</span>),</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                      (<span class="st">'year'</span>, <span class="st">'int32'</span>),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                      (<span class="st">'month'</span>, <span class="st">'int16'</span>)])</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>name <span class="op">=</span> <span class="st">'new_table'</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>db.create_table(name, schema<span class="op">=</span>schema)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By default, this stores the data files in the database default location. You can force a particular path with the <code>location</code> option.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> getpass <span class="im">import</span> getuser</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>schema <span class="op">=</span> ibis.schema([(<span class="st">'foo'</span>, <span class="st">'string'</span>),</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                      (<span class="st">'year'</span>, <span class="st">'int32'</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                      (<span class="st">'month'</span>, <span class="st">'int16'</span>)])</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>name <span class="op">=</span> <span class="st">'new_table'</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>location <span class="op">=</span> <span class="st">'/home/</span><span class="sc">{}</span><span class="st">/new-table-data'</span>.<span class="bu">format</span>(getuser())</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>db.create_table(name, schema<span class="op">=</span>schema, location<span class="op">=</span>location)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If the schema matches a known table schema, you can always use the <code>schema</code> method to get a schema object:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t <span class="op">=</span> db.table(<span class="st">'functional_alltypes'</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t.schema()</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>ibis.Schema {</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">id</span>               int32</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  bool_col         boolean</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  tinyint_col      int8</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  smallint_col     int16</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  int_col          int32</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  bigint_col       int64</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  float_col        float32</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  double_col       float64</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  date_string_col  string</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  string_col       string</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  timestamp_col    timestamp</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  year             int32</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  month            int32</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="creating-a-partitioned-table" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-partitioned-table">Creating a partitioned table</h3>
<p>To create an empty partitioned table, include a list of columns to be used as the partition keys.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>schema <span class="op">=</span> ibis.schema([(<span class="st">'foo'</span>, <span class="st">'string'</span>),</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                      (<span class="st">'year'</span>, <span class="st">'int32'</span>),</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                      (<span class="st">'month'</span>, <span class="st">'int16'</span>)])</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>name <span class="op">=</span> <span class="st">'new_table'</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>db.create_table(name, schema<span class="op">=</span>schema, partition<span class="op">=</span>[<span class="st">'year'</span>, <span class="st">'month'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="partitioned-tables" class="level2">
<h2 class="anchored" data-anchor-id="partitioned-tables">Partitioned tables</h2>
<p>Ibis enables you to manage partitioned tables in various ways. Since each partition behaves as its own "subtable" sharing a common schema, each partition can have its own file format, directory path, serialization properties, and so forth.</p>
<p>There are a handful of table methods for adding and removing partitions and getting information about the partition schema and any existing partition data:</p>
<pre><code>&lt;!-- prettier-ignore-start --&gt;
::: ibis.backends.impala.client.ImpalaTable
    options:
      heading_level: 3
      members:
        - add_partition
        - drop_partition
        - is_partitioned
        - partition_schema
        - partitions

&lt;!-- prettier-ignore-end --&gt;</code></pre>
<p>To address a specific partition in any method that is partition specific, you can either use a dict with the partition key names and values, or pass a list of the partition values:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>schema <span class="op">=</span> ibis.schema([(<span class="st">'foo'</span>, <span class="st">'string'</span>),</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                      (<span class="st">'year'</span>, <span class="st">'int32'</span>),</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                      (<span class="st">'month'</span>, <span class="st">'int16'</span>)])</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>name <span class="op">=</span> <span class="st">'new_table'</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>db.create_table(name, schema<span class="op">=</span>schema, partition<span class="op">=</span>[<span class="st">'year'</span>, <span class="st">'month'</span>])</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> db.table(name)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>table.add_partition({<span class="st">'year'</span>: <span class="dv">2007</span>, <span class="st">'month'</span>, <span class="dv">4</span>})</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>table.add_partition([<span class="dv">2007</span>, <span class="dv">5</span>])</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>table.add_partition([<span class="dv">2007</span>, <span class="dv">6</span>])</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>table.drop_partition([<span class="dv">2007</span>, <span class="dv">6</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We’ll cover partition metadata management and data loading below.</p>
</section>
<section id="inserting-data-into-tables" class="level2">
<h2 class="anchored" data-anchor-id="inserting-data-into-tables">Inserting data into tables</h2>
<p>If the schemas are compatible, you can insert into a table directly from an Ibis table expression:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t <span class="op">=</span> db.functional_alltypes</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> db.create_table(<span class="st">'insert_test'</span>, schema<span class="op">=</span>t.schema())</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> target <span class="op">=</span> db.table(<span class="st">'insert_test'</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> target.insert(t[:<span class="dv">3</span>])</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> target.insert(t[:<span class="dv">3</span>])</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> target.insert(t[:<span class="dv">3</span>])</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> target.to_pandas()</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>     <span class="bu">id</span>  bool_col  tinyint_col  ...           timestamp_col  year  month</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">5770</span>      <span class="va">True</span>            <span class="dv">0</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">00</span>:<span class="fl">00.000</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">5771</span>     <span class="va">False</span>            <span class="dv">1</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">0</span><span class="er">1</span>:<span class="fl">00.000</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">5772</span>      <span class="va">True</span>            <span class="dv">2</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">0</span><span class="er">2</span>:<span class="fl">00.100</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">5770</span>      <span class="va">True</span>            <span class="dv">0</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">00</span>:<span class="fl">00.000</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="dv">5771</span>     <span class="va">False</span>            <span class="dv">1</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">0</span><span class="er">1</span>:<span class="fl">00.000</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="dv">5772</span>      <span class="va">True</span>            <span class="dv">2</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">0</span><span class="er">2</span>:<span class="fl">00.100</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="dv">5770</span>      <span class="va">True</span>            <span class="dv">0</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">00</span>:<span class="fl">00.000</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>  <span class="dv">5771</span>     <span class="va">False</span>            <span class="dv">1</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">0</span><span class="er">1</span>:<span class="fl">00.000</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>  <span class="dv">5772</span>      <span class="va">True</span>            <span class="dv">2</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">0</span><span class="er">2</span>:<span class="fl">00.100</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>[<span class="dv">9</span> rows x <span class="dv">13</span> columns]</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> target.drop()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If the table is partitioned, you must indicate the partition you are inserting into:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>part <span class="op">=</span> {<span class="st">'year'</span>: <span class="dv">2007</span>, <span class="st">'month'</span>: <span class="dv">4</span>}</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>table.insert(expr, partition<span class="op">=</span>part)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="managing-table-metadata" class="level2">
<h2 class="anchored" data-anchor-id="managing-table-metadata">Managing table metadata</h2>
<p>Ibis has functions that wrap many of the DDL commands for Impala table metadata.</p>
<section id="detailed-table-metadata-describe-formatted" class="level3">
<h3 class="anchored" data-anchor-id="detailed-table-metadata-describe-formatted">Detailed table metadata: <code>DESCRIBE FORMATTED</code></h3>
<p>To get a handy wrangled version of <code>DESCRIBE FORMATTED</code> use the <code>metadata</code> method.</p>
<pre><code>&lt;!-- prettier-ignore-start --&gt;
::: ibis.backends.impala.client.ImpalaTable.metadata
    options:
      heading_level: 3
&lt;!-- prettier-ignore-end --&gt;</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t <span class="op">=</span> client.table(<span class="st">'ibis_testing.functional_alltypes'</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> meta <span class="op">=</span> t.metadata()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> meta</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span><span class="kw">class</span> <span class="st">'ibis.backends.impala.metadata.TableMetadata'</span><span class="op">&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>{<span class="st">'info'</span>: {<span class="st">'CreateTime'</span>: datetime.datetime(<span class="dv">2021</span>, <span class="dv">1</span>, <span class="dv">14</span>, <span class="dv">21</span>, <span class="dv">23</span>, <span class="dv">8</span>),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Database'</span>: <span class="st">'ibis_testing'</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">'LastAccessTime'</span>: <span class="st">'UNKNOWN'</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Location'</span>: <span class="st">'hdfs://impala:8020/__ibis/ibis-testing-data/parquet/functional_alltypes'</span>,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Owner'</span>: <span class="st">'root'</span>,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Protect Mode'</span>: <span class="st">'None'</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Retention'</span>: <span class="dv">0</span>,</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Table Parameters'</span>: {<span class="st">'COLUMN_STATS_ACCURATE'</span>: <span class="va">False</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'EXTERNAL'</span>: <span class="va">True</span>,</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'STATS_GENERATED_VIA_STATS_TASK'</span>: <span class="va">True</span>,</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'numFiles'</span>: <span class="dv">3</span>,</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'numRows'</span>: <span class="dv">7300</span>,</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'rawDataSize'</span>: <span class="st">'-1'</span>,</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'totalSize'</span>: <span class="dv">106278</span>,</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'transient_lastDdlTime'</span>: datetime.datetime(<span class="dv">2021</span>, <span class="dv">1</span>, <span class="dv">14</span>, <span class="dv">21</span>, <span class="dv">23</span>, <span class="dv">17</span>)},</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Table Type'</span>: <span class="st">'EXTERNAL_TABLE'</span>},</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'schema'</span>: [(<span class="st">'id'</span>, <span class="st">'int'</span>),</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'bool_col'</span>, <span class="st">'boolean'</span>),</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'tinyint_col'</span>, <span class="st">'tinyint'</span>),</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'smallint_col'</span>, <span class="st">'smallint'</span>),</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'int_col'</span>, <span class="st">'int'</span>),</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'bigint_col'</span>, <span class="st">'bigint'</span>),</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'float_col'</span>, <span class="st">'float'</span>),</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'double_col'</span>, <span class="st">'double'</span>),</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'date_string_col'</span>, <span class="st">'string'</span>),</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'string_col'</span>, <span class="st">'string'</span>),</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'timestamp_col'</span>, <span class="st">'timestamp'</span>),</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'year'</span>, <span class="st">'int'</span>),</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'month'</span>, <span class="st">'int'</span>)],</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a> <span class="st">'storage info'</span>: {<span class="st">'Bucket Columns'</span>: <span class="st">'[]'</span>,</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Compressed'</span>: <span class="va">False</span>,</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'InputFormat'</span>: <span class="st">'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat'</span>,</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Num Buckets'</span>: <span class="dv">0</span>,</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'OutputFormat'</span>: <span class="st">'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat'</span>,</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'SerDe Library'</span>: <span class="st">'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'</span>,</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Sort Columns'</span>: <span class="st">'[]'</span>}}</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> meta.location</span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a><span class="co">'hdfs://impala:8020/__ibis/ibis-testing-data/parquet/functional_alltypes'</span></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> meta.create_time</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>datetime.datetime(<span class="dv">2021</span>, <span class="dv">1</span>, <span class="dv">14</span>, <span class="dv">21</span>, <span class="dv">23</span>, <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>files</code> function is also available to see all of the physical HDFS data files backing a table:</p>
<pre><code>&lt;!-- prettier-ignore-start --&gt;
::: ibis.backends.impala.client.ImpalaTable
    options:
      heading_level: 3
      members:
        - files

&lt;!-- prettier-ignore-end --&gt;</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> ss <span class="op">=</span> c.table(<span class="st">'tpcds_parquet.store_sales'</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> ss.files()[:<span class="dv">5</span>]</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                                                path      size  <span class="op">\</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...  <span class="fl">160.61</span><span class="er">KB</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...  <span class="fl">123.88</span><span class="er">KB</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...  <span class="fl">139.28</span><span class="er">KB</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...  <span class="fl">139.60</span><span class="er">KB</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...   <span class="fl">62.84</span><span class="er">KB</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>                 partition</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  ss_sold_date_sk<span class="op">=</span><span class="dv">2451803</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  ss_sold_date_sk<span class="op">=</span><span class="dv">2451819</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  ss_sold_date_sk<span class="op">=</span><span class="dv">2451772</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  ss_sold_date_sk<span class="op">=</span><span class="dv">2451789</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  ss_sold_date_sk<span class="op">=</span><span class="dv">2451741</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="modifying-table-metadata" class="level3">
<h3 class="anchored" data-anchor-id="modifying-table-metadata">Modifying table metadata</h3>
<p>For unpartitioned tables, you can use the <code>alter</code> method to change its location, file format, and other properties. For partitioned tables, to change partition-specific metadata use <code>alter_partition</code>.</p>
<pre><code>&lt;!-- prettier-ignore-start --&gt;
::: ibis.backends.impala.client.ImpalaTable
    options:
      heading_level: 3
      members:
        - alter
        - alter_partition

&lt;!-- prettier-ignore-end --&gt;</code></pre>
<p>For example, if you wanted to "point" an existing table at a directory of CSV files, you could run the following command:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> getpass <span class="im">import</span> getuser</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>csv_props <span class="op">=</span> {</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'serialization.format'</span>: <span class="st">','</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'field.delim'</span>: <span class="st">','</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>data_dir <span class="op">=</span> <span class="st">'/home/</span><span class="sc">{}</span><span class="st">/my-csv-files'</span>.<span class="bu">format</span>(getuser())</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>table.alter(location<span class="op">=</span>data_dir, <span class="bu">format</span><span class="op">=</span><span class="st">'text'</span>, serde_properties<span class="op">=</span>csv_props)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If the table is partitioned, you can modify only the properties of a particular partition:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>table.alter_partition(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'year'</span>: <span class="dv">2007</span>, <span class="st">'month'</span>: <span class="dv">5</span>},</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    location<span class="op">=</span>data_dir,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">format</span><span class="op">=</span><span class="st">'text'</span>,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    serde_properties<span class="op">=</span>csv_props</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="table-statistics" class="level2">
<h2 class="anchored" data-anchor-id="table-statistics">Table statistics</h2>
<section id="computing-table-and-partition-statistics" class="level3">
<h3 class="anchored" data-anchor-id="computing-table-and-partition-statistics">Computing table and partition statistics</h3>
<pre><code>&lt;!-- prettier-ignore-start --&gt;
::: ibis.backends.impala.client.ImpalaTable
    options:
      heading_level: 3
      members:
        - compute_stats

&lt;!-- prettier-ignore-end --&gt;</code></pre>
<p>Impala-backed physical tables have a method <code>compute_stats</code> that computes table, column, and partition-level statistics to assist with query planning and optimization. It is standard practice to invoke this after creating a table or loading new data:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>table.compute_stats()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you are using a recent version of Impala, you can also access the <code>COMPUTE INCREMENTAL STATS</code> DDL command:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>table.compute_stats(incremental<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="seeing-table-and-column-statistics" class="level3">
<h3 class="anchored" data-anchor-id="seeing-table-and-column-statistics">Seeing table and column statistics</h3>
<pre><code>&lt;!-- prettier-ignore-start --&gt;
::: ibis.backends.impala.client.ImpalaTable
    options:
      heading_level: 3
      members:
        - column_stats
        - stats

&lt;!-- prettier-ignore-end --&gt;</code></pre>
<p>The <code>compute_stats</code> and <code>stats</code> functions return the results of <code>SHOW COLUMN STATS</code> and <code>SHOW TABLE STATS</code>, respectively, and their output will depend, of course, on the last <code>COMPUTE STATS</code> call.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> ss <span class="op">=</span> c.table(<span class="st">'tpcds_parquet.store_sales'</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> ss.compute_stats(incremental<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> stats <span class="op">=</span> ss.stats()</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> stats[:<span class="dv">5</span>]</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  ss_sold_date_sk  <span class="co">#Rows  #Files     Size Bytes Cached Cache Replication  \</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>         <span class="dv">2450829</span>   <span class="dv">1071</span>       <span class="dv">1</span>  <span class="fl">78.34</span><span class="er">KB</span>   NOT CACHED        NOT CACHED</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>         <span class="dv">2450846</span>    <span class="dv">839</span>       <span class="dv">1</span>  <span class="fl">61.83</span><span class="er">KB</span>   NOT CACHED        NOT CACHED</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>         <span class="dv">2450860</span>    <span class="dv">747</span>       <span class="dv">1</span>  <span class="fl">54.86</span><span class="er">KB</span>   NOT CACHED        NOT CACHED</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>         <span class="dv">2450874</span>    <span class="dv">922</span>       <span class="dv">1</span>  <span class="fl">66.74</span><span class="er">KB</span>   NOT CACHED        NOT CACHED</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>         <span class="dv">2450888</span>    <span class="dv">856</span>       <span class="dv">1</span>  <span class="fl">63.33</span><span class="er">KB</span>   NOT CACHED        NOT CACHED</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    Format Incremental stats  <span class="op">\</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  PARQUET              true</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  PARQUET              true</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  PARQUET              true</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  PARQUET              true</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  PARQUET              true</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>                                            Location</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> cstats <span class="op">=</span> ss.column_stats()</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> cstats</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>                   Column          Type  <span class="co">#Distinct Values  #Nulls  Max Size  Avg Size</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>         ss_sold_time_sk        BIGINT             <span class="dv">13879</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">8</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>              ss_item_sk        BIGINT             <span class="dv">17925</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">8</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>          ss_customer_sk        BIGINT             <span class="dv">15207</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">8</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>             ss_cdemo_sk        BIGINT             <span class="dv">16968</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">8</span></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>             ss_hdemo_sk        BIGINT              <span class="dv">6220</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">8</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>              ss_addr_sk        BIGINT             <span class="dv">14077</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">8</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>             ss_store_sk        BIGINT                 <span class="dv">6</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">8</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>             ss_promo_sk        BIGINT               <span class="dv">298</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">8</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>        ss_ticket_number           INT             <span class="dv">15006</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>             ss_quantity           INT                <span class="dv">99</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>      ss_wholesale_cost  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)             <span class="dv">10196</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span>          ss_list_price  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)             <span class="dv">19393</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span>         ss_sales_price  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)             <span class="dv">15594</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span>    ss_ext_discount_amt  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)             <span class="dv">29772</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span>     ss_ext_sales_price  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)            <span class="dv">102758</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span>  ss_ext_wholesale_cost  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)            <span class="dv">125448</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span>      ss_ext_list_price  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)            <span class="dv">141419</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span>             ss_ext_tax  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)             <span class="dv">33837</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a><span class="dv">18</span>          ss_coupon_amt  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)             <span class="dv">29772</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a><span class="dv">19</span>            ss_net_paid  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)            <span class="dv">109981</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a><span class="dv">20</span>    ss_net_paid_inc_tax  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)            <span class="dv">132286</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a><span class="dv">21</span>          ss_net_profit  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)            <span class="dv">122436</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a><span class="dv">22</span>        ss_sold_date_sk        BIGINT               <span class="dv">120</span>       <span class="dv">0</span>       NaN         <span class="dv">8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="refresh-and-invalidate-metadata" class="level3">
<h3 class="anchored" data-anchor-id="refresh-and-invalidate-metadata"><code>REFRESH</code> and <code>INVALIDATE METADATA</code></h3>
<p>These DDL commands are available as table-level and client-level methods:</p>
<pre><code>&lt;!-- prettier-ignore-start --&gt;
::: ibis.backends.impala.Backend
    options:
      heading_level: 3
      members:
        - invalidate_metadata

&lt;!-- prettier-ignore-end --&gt;

&lt;!-- prettier-ignore-start --&gt;
::: ibis.backends.impala.client.ImpalaTable
    options:
      heading_level: 3
      members:
        - invalidate_metadata
        - refresh

&lt;!-- prettier-ignore-end --&gt;</code></pre>
<p>You can invalidate the cached metadata for a single table or for all tables using <code>invalidate_metadata</code>, and similarly invoke <code>REFRESH db_name.table_name</code> using the <code>refresh</code> method.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>client.invalidate_metadata()</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> db.table(table_name)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>table.invalidate_metadata()</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>table.refresh()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These methods are often used in conjunction with the <code>LOAD DATA</code> commands and <code>COMPUTE STATS</code>. See the Impala documentation for full details.</p>
</section>
</section>
<section id="issuing-load-data-commands" class="level2">
<h2 class="anchored" data-anchor-id="issuing-load-data-commands">Issuing <code>LOAD DATA</code> commands</h2>
<p>The <code>LOAD DATA</code> DDL physically moves a single data file or a directory of files into the correct location for a table or table partition. It is especially useful for partitioned tables as you do not have to construct the directory path for a partition by hand, so simpler and less error-prone than manually moving files with low level HDFS commands. It also deals with file name conflicts so data is not lost in such cases.</p>
<pre><code>&lt;!-- prettier-ignore-start --&gt;
::: ibis.backends.impala.Backend
    options:
      heading_level: 3
      members:
        - load_data

&lt;!-- prettier-ignore-end --&gt;

&lt;!-- prettier-ignore-start --&gt;
::: ibis.backends.impala.client.ImpalaTable
    options:
      heading_level: 3
      members:
        - load_data

&lt;!-- prettier-ignore-end --&gt;</code></pre>
<p>To use these methods, pass the path of a single file or a directory of files you want to load. Afterward, you may want to update the table statistics (see Impala documentation):</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>table.load_data(path)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>table.refresh()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Like the other methods with support for partitioned tables, you can load into a particular partition with the <code>partition</code> keyword argument:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>part <span class="op">=</span> [<span class="dv">2007</span>, <span class="dv">5</span>]</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>table.load_data(path, partition<span class="op">=</span>part)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="parquet-and-other-session-options" class="level2">
<h2 class="anchored" data-anchor-id="parquet-and-other-session-options">Parquet and other session options</h2>
<p>Ibis gives you access to Impala session-level variables that affect query execution:</p>
<pre><code>&lt;!-- prettier-ignore-start --&gt;
::: ibis.backends.impala.Backend
    options:
      heading_level: 3
      members:
        - disable_codegen
        - get_options
        - set_options
        - set_compression_codec

&lt;!-- prettier-ignore-end --&gt;</code></pre>
<p>For example:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> client.get_options()</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>{<span class="st">'ABORT_ON_ERROR'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'APPX_COUNT_DISTINCT'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'BUFFER_POOL_LIMIT'</span>: <span class="st">''</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'COMPRESSION_CODEC'</span>: <span class="st">''</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'COMPUTE_STATS_MIN_SAMPLE_SIZE'</span>: <span class="st">'1073741824'</span>,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'DEFAULT_JOIN_DISTRIBUTION_MODE'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'DEFAULT_SPILLABLE_BUFFER_SIZE'</span>: <span class="st">'2097152'</span>,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'DISABLE_CODEGEN'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'DISABLE_CODEGEN_ROWS_THRESHOLD'</span>: <span class="st">'50000'</span>,</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'DISABLE_ROW_RUNTIME_FILTERING'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'DISABLE_STREAMING_PREAGGREGATIONS'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'DISABLE_UNSAFE_SPILLS'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'ENABLE_EXPR_REWRITES'</span>: <span class="st">'1'</span>,</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'EXEC_SINGLE_NODE_ROWS_THRESHOLD'</span>: <span class="st">'100'</span>,</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'EXEC_TIME_LIMIT_S'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a> <span class="st">'EXPLAIN_LEVEL'</span>: <span class="st">'1'</span>,</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a> <span class="st">'HBASE_CACHE_BLOCKS'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'HBASE_CACHING'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'IDLE_SESSION_TIMEOUT'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'MAX_ERRORS'</span>: <span class="st">'100'</span>,</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a> <span class="st">'MAX_NUM_RUNTIME_FILTERS'</span>: <span class="st">'10'</span>,</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a> <span class="st">'MAX_ROW_SIZE'</span>: <span class="st">'524288'</span>,</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a> <span class="st">'MEM_LIMIT'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a> <span class="st">'MIN_SPILLABLE_BUFFER_SIZE'</span>: <span class="st">'65536'</span>,</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a> <span class="st">'MT_DOP'</span>: <span class="st">''</span>,</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a> <span class="st">'NUM_SCANNER_THREADS'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a> <span class="st">'OPTIMIZE_PARTITION_KEY_SCANS'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a> <span class="st">'PARQUET_ANNOTATE_STRINGS_UTF8'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a> <span class="st">'PARQUET_ARRAY_RESOLUTION'</span>: <span class="st">'2'</span>,</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a> <span class="st">'PARQUET_DICTIONARY_FILTERING'</span>: <span class="st">'1'</span>,</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a> <span class="st">'PARQUET_FALLBACK_SCHEMA_RESOLUTION'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a> <span class="st">'PARQUET_FILE_SIZE'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a> <span class="st">'PARQUET_READ_STATISTICS'</span>: <span class="st">'1'</span>,</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a> <span class="st">'PREFETCH_MODE'</span>: <span class="st">'1'</span>,</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a> <span class="st">'QUERY_TIMEOUT_S'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a> <span class="st">'REPLICA_PREFERENCE'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a> <span class="st">'REQUEST_POOL'</span>: <span class="st">''</span>,</span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a> <span class="st">'RUNTIME_BLOOM_FILTER_SIZE'</span>: <span class="st">'1048576'</span>,</span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a> <span class="st">'RUNTIME_FILTER_MAX_SIZE'</span>: <span class="st">'16777216'</span>,</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a> <span class="st">'RUNTIME_FILTER_MIN_SIZE'</span>: <span class="st">'1048576'</span>,</span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a> <span class="st">'RUNTIME_FILTER_MODE'</span>: <span class="st">'2'</span>,</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a> <span class="st">'RUNTIME_FILTER_WAIT_TIME_MS'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a> <span class="st">'S3_SKIP_INSERT_STAGING'</span>: <span class="st">'1'</span>,</span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a> <span class="st">'SCHEDULE_RANDOM_REPLICA'</span>: <span class="st">'0'</span>,</span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a> <span class="st">'SCRATCH_LIMIT'</span>: <span class="st">'-1'</span>,</span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a> <span class="st">'SEQ_COMPRESSION_MODE'</span>: <span class="st">''</span>,</span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a> <span class="st">'SYNC_DDL'</span>: <span class="st">'0'</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To enable Snappy compression for Parquet files, you could do either of:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> client.set_options({<span class="st">'COMPRESSION_CODEC'</span>: <span class="st">'snappy'</span>})</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> client.set_compression_codec(<span class="st">'snappy'</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> client.get_options()[<span class="st">'COMPRESSION_CODEC'</span>]</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co">'SNAPPY'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="ingesting-data-from-pandas" class="level2">
<h2 class="anchored" data-anchor-id="ingesting-data-from-pandas">Ingesting data from pandas</h2>
<p>Overall interoperability between the Hadoop / Spark ecosystems and pandas / the PyData stack is poor, but it will improve in time (this is a major part of the Ibis roadmap).</p>
<p>Ibis’s Impala tools currently interoperate with pandas in these ways:</p>
<ul>
<li>Ibis expressions return pandas objects (i.e.&nbsp;DataFrame or Series) for non-scalar expressions when calling their <code>to_pandas</code> method</li>
<li>The <code>create_table</code> and <code>insert</code> methods can accept pandas objects. This includes inserting into partitioned tables. It currently uses CSV as the ingest route.</li>
</ul>
<p>For example:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> data <span class="op">=</span> pd.DataFrame({<span class="st">'foo'</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>], <span class="st">'bar'</span>: [<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>]})</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> db.create_table(<span class="st">'pandas_table'</span>, data)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t <span class="op">=</span> db.pandas_table</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t.to_pandas()</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  bar  foo</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   a    <span class="dv">1</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   b    <span class="dv">2</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   c    <span class="dv">3</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   d    <span class="dv">4</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t.drop()</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> db.create_table(<span class="st">'empty_for_insert'</span>, schema<span class="op">=</span>t.schema())</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> to_insert <span class="op">=</span> db.empty_for_insert</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> to_insert.insert(data)</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> to_insert.to_pandas()</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>  bar  foo</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   a    <span class="dv">1</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   b    <span class="dv">2</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   c    <span class="dv">3</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   d    <span class="dv">4</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> to_insert.drop()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> data <span class="op">=</span> pd.DataFrame({<span class="st">'foo'</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>], <span class="st">'bar'</span>: [<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>]})</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> db.create_table(<span class="st">'pandas_table'</span>, data)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t <span class="op">=</span> db.pandas_table</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t.to_pandas()</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>   foo bar</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">1</span>   a</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">2</span>   b</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="dv">3</span>   c</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="dv">4</span>   d</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t.drop()</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> db.create_table(<span class="st">'empty_for_insert'</span>, schema<span class="op">=</span>t.schema())</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> to_insert <span class="op">=</span> db.empty_for_insert</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> to_insert.insert(data)</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> to_insert.to_pandas()</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>   foo bar</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">1</span>   a</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">2</span>   b</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="dv">3</span>   c</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="dv">4</span>   d</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> to_insert.drop()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="uploading-downloading-data-from-hdfs" class="level2">
<h2 class="anchored" data-anchor-id="uploading-downloading-data-from-hdfs">Uploading / downloading data from HDFS</h2>
<p>If you’ve set up an HDFS connection, you can use the Ibis HDFS interface to look through your data and read and write files to and from HDFS:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> hdfs <span class="op">=</span> con.hdfs</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> hdfs.ls(<span class="st">'/__ibis/ibis-testing-data'</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>[<span class="st">'README.md'</span>,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'avro'</span>,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'awards_players.csv'</span>,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'batting.csv'</span>,</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'csv'</span>,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'diamonds.csv'</span>,</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'functional_alltypes.csv'</span>,</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'functional_alltypes.parquet'</span>,</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'geo.csv'</span>,</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'ibis_testing.db'</span>,</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'parquet'</span>,</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'struct_table.avro'</span>,</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'udf'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> hdfs.ls(<span class="st">'/__ibis/ibis-testing-data/parquet'</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>[<span class="st">'functional_alltypes'</span>,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_customer'</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_lineitem'</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_nation'</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_orders'</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_part'</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_partsupp'</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_region'</span>,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_supplier'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Suppose we wanted to download <code>/__ibis/ibis-testing-data/parquet/functional_alltypes</code>, which is a directory. We need only do:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> rm <span class="at">-rf</span> parquet_dir/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> hdfs.get(<span class="st">'/__ibis/ibis-testing-data/parquet/functional_alltypes'</span>,</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>...          <span class="st">'parquet_dir'</span>,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>...           recursive<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co">'/ibis/docs/source/tutorial/parquet_dir'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we have that directory locally:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls parquet_dir/</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="ex">9a41de519352ab07-4e76bc4d9fb5a789_1624886651_data.0.parq</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="ex">9a41de519352ab07-4e76bc4d9fb5a78a_778826485_data.0.parq</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="ex">9a41de519352ab07-4e76bc4d9fb5a78b_1277612014_data.0.parq</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Files and directories can be written to HDFS just as easily using <code>put</code>:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> path <span class="op">=</span> <span class="st">'/__ibis/dir-write-example'</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> hdfs.rm(path, recursive<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> hdfs.put(path, <span class="st">'parquet_dir'</span>, recursive<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> hdfs.ls(<span class="st">'/__ibis/dir-write-example'</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>[<span class="st">'9a41de519352ab07-4e76bc4d9fb5a789_1624886651_data.0.parq'</span>,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'9a41de519352ab07-4e76bc4d9fb5a78a_778826485_data.0.parq'</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'9a41de519352ab07-4e76bc4d9fb5a78b_1277612014_data.0.parq'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Delete files and directories with <code>rm</code>:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> hdfs.rm(<span class="st">'/__ibis/dir-write-example'</span>, recursive<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> parquet_dir/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="queries-on-parquet-avro-and-delimited-files-in-hdfs" class="level2">
<h2 class="anchored" data-anchor-id="queries-on-parquet-avro-and-delimited-files-in-hdfs">Queries on Parquet, Avro, and Delimited files in HDFS</h2>
<p>Ibis can easily create temporary or persistent Impala tables that reference data in the following formats:</p>
<ul>
<li>Parquet (<code>parquet_file</code>)</li>
<li>Avro (<code>avro_file</code>)</li>
<li>Delimited text formats (CSV, TSV, etc.) (<code>delimited_file</code>)</li>
</ul>
<p>Parquet is the easiest because the schema can be read from the data files:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> path <span class="op">=</span> <span class="st">'/__ibis/ibis-testing-data/parquet/tpch_lineitem'</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> lineitem <span class="op">=</span> con.parquet_file(path)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> lineitem.limit(<span class="dv">2</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>   l_orderkey  l_partkey  l_suppkey  l_linenumber l_quantity l_extendedprice  <span class="op">\</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>           <span class="dv">1</span>     <span class="dv">155190</span>       <span class="dv">7706</span>             <span class="dv">1</span>      <span class="fl">17.00</span>        <span class="fl">21168.23</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>           <span class="dv">1</span>      <span class="dv">67310</span>       <span class="dv">7311</span>             <span class="dv">2</span>      <span class="fl">36.00</span>        <span class="fl">45983.16</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  l_discount l_tax l_returnflag l_linestatus  l_shipdate l_commitdate  <span class="op">\</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>       <span class="fl">0.04</span>  <span class="fl">0.02</span>            N            O  <span class="dv">1996</span><span class="op">-</span><span class="dv">0</span><span class="er">3</span><span class="op">-</span><span class="dv">13</span>   <span class="dv">1996</span><span class="op">-</span><span class="dv">0</span><span class="er">2</span><span class="op">-</span><span class="dv">12</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       <span class="fl">0.09</span>  <span class="fl">0.06</span>            N            O  <span class="dv">1996</span><span class="op">-</span><span class="dv">0</span><span class="er">4</span><span class="op">-</span><span class="dv">12</span>   <span class="dv">1996</span><span class="op">-</span><span class="dv">0</span><span class="er">2</span><span class="op">-</span><span class="dv">28</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  l_receiptdate     l_shipinstruct l_shipmode  <span class="op">\</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">1996</span><span class="op">-</span><span class="dv">0</span><span class="er">3</span><span class="op">-</span><span class="dv">22</span>  DELIVER IN PERSON      TRUCK</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">1996</span><span class="op">-</span><span class="dv">0</span><span class="er">4</span><span class="op">-</span><span class="dv">20</span>   TAKE BACK RETURN       MAIL</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>                            l_comment</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>             egular courts above the</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  ly final dependencies: slyly bold</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> lineitem.l_extendedprice.<span class="bu">sum</span>()</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>Decimal(<span class="st">'229577310901.20'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you want to query a Parquet file and also create a table in Impala that remains after your session, you can pass more information to <code>parquet_file</code>:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> table <span class="op">=</span> con.parquet_file(path, name<span class="op">=</span><span class="st">'my_parquet_table'</span>,</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>...                          database<span class="op">=</span><span class="st">'ibis_testing'</span>,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>...                          persist<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> table.l_extendedprice.<span class="bu">sum</span>()</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>Decimal(<span class="st">'229577310901.20'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.table(<span class="st">'my_parquet_table'</span>).l_extendedprice.<span class="bu">sum</span>()</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>Decimal(<span class="st">'229577310901.20'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.drop_table(<span class="st">'my_parquet_table'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To query delimited files, you need to write down an Ibis schema. At some point we’d like to build some helper tools that will infer the schema for you, all in good time.</p>
<p>There’s some CSV files in the test folder, so let’s use those:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> hdfs.get(<span class="st">'/__ibis/ibis-testing-data/csv'</span>, <span class="st">'csv-files'</span>, recursive<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co">'/ibis/docs/source/tutorial/csv-files'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb66"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cat csv-files/0.csv</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="ex">63IEbRheTh,0.679388707915,6</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="ex">mG4hlqnjeG,2.80710565922,15</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="ex">JTPdX9SZH5,-0.155126406372,55</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2jcl6FypOl,1.03787834032,21</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="ex">k3TbJLaadQ,-1.40190801103,23</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="ex">rP5J4xvinM,-0.442092712869,22</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="ex">WniUylixYt,-0.863748033806,27</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="ex">znsDuKOB1n,-0.566029637098,47</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="ex">4SRP9jlo1M,0.331460412318,88</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="ex">KsfjPyDf5e,-0.578930506363,70</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> rm <span class="at">-rf</span> csv-files/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The schema here is pretty simple (see <code>ibis.schema</code> for more):</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> schema <span class="op">=</span> ibis.schema([(<span class="st">'foo'</span>, <span class="st">'string'</span>),</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>...                       (<span class="st">'bar'</span>, <span class="st">'double'</span>),</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>...                       (<span class="st">'baz'</span>, <span class="st">'int32'</span>)])</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> table <span class="op">=</span> con.delimited_file(<span class="st">'/__ibis/ibis-testing-data/csv'</span>,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>...                            schema)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> table.limit(<span class="dv">10</span>)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>          foo       bar  baz</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">63</span><span class="er">IEbRheTh</span>  <span class="fl">0.679389</span>    <span class="dv">6</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  mG4hlqnjeG  <span class="fl">2.807106</span>   <span class="dv">15</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  JTPdX9SZH5 <span class="op">-</span><span class="fl">0.155126</span>   <span class="dv">55</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="ot">2j</span><span class="er">cl6FypOl</span>  <span class="fl">1.037878</span>   <span class="dv">21</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  k3TbJLaadQ <span class="op">-</span><span class="fl">1.401908</span>   <span class="dv">23</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  rP5J4xvinM <span class="op">-</span><span class="fl">0.442093</span>   <span class="dv">22</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  WniUylixYt <span class="op">-</span><span class="fl">0.863748</span>   <span class="dv">27</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>  znsDuKOB1n <span class="op">-</span><span class="fl">0.566030</span>   <span class="dv">47</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>  <span class="dv">4</span><span class="er">SRP9jlo1M</span>  <span class="fl">0.331460</span>   <span class="dv">88</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>  KsfjPyDf5e <span class="op">-</span><span class="fl">0.578931</span>   <span class="dv">70</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> table.bar.summary()</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>   count  nulls       <span class="bu">min</span>       <span class="bu">max</span>       <span class="bu">sum</span>    mean  approx_nunique</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">100</span>      <span class="dv">0</span> <span class="op">-</span><span class="fl">1.401908</span>  <span class="fl">2.807106</span>  <span class="fl">8.479978</span>  <span class="fl">0.0848</span>              <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For functions like <code>parquet_file</code> and <code>delimited_file</code>, an HDFS directory must be passed (we’ll add support for S3 and other filesystems later) and the directory must contain files all having the same schema.</p>
<p>If you have Avro data, you can query it too if you have the full avro schema:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> avro_schema <span class="op">=</span> {</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>...     <span class="st">"fields"</span>: [</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>...         {<span class="st">"type"</span>: [<span class="st">"int"</span>, <span class="st">"null"</span>], <span class="st">"name"</span>: <span class="st">"R_REGIONKEY"</span>},</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>...         {<span class="st">"type"</span>: [<span class="st">"string"</span>, <span class="st">"null"</span>], <span class="st">"name"</span>: <span class="st">"R_NAME"</span>},</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>...         {<span class="st">"type"</span>: [<span class="st">"string"</span>, <span class="st">"null"</span>], <span class="st">"name"</span>: <span class="st">"R_COMMENT"</span>}],</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>...     <span class="st">"type"</span>: <span class="st">"record"</span>,</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>...     <span class="st">"name"</span>: <span class="st">"a"</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>... }</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> path <span class="op">=</span> <span class="st">'/__ibis/ibis-testing-data/avro/tpch.region'</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> hdfs.mkdir(path, create_parents<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> table <span class="op">=</span> con.avro_file(path, avro_schema)</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> table</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>Empty DataFrame</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>Columns: [r_regionkey, r_name, r_comment]</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>Index: []</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="other-helper-functions-for-interacting-with-the-database" class="level2">
<h2 class="anchored" data-anchor-id="other-helper-functions-for-interacting-with-the-database">Other helper functions for interacting with the database</h2>
<p>We’re adding a growing list of useful utility functions for interacting with an Impala cluster on the client object. The idea is that you should be able to do any database-admin-type work with Ibis and not have to switch over to the Impala SQL shell. Any ways we can make this more pleasant, please let us know.</p>
<p>Here’s some of the features, which we’ll give examples for:</p>
<ul>
<li>Listing and searching for available databases and tables</li>
<li>Creating and dropping databases</li>
<li>Getting table schemas</li>
</ul>
<div class="sourceCode" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.list_databases(like<span class="op">=</span><span class="st">'ibis*'</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>[<span class="st">'ibis_testing'</span>, <span class="st">'ibis_testing_tmp_db'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.list_tables(database<span class="op">=</span><span class="st">'ibis_testing'</span>, like<span class="op">=</span><span class="st">'tpch*'</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>[<span class="st">'tpch_customer'</span>,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_lineitem'</span>,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_nation'</span>,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_orders'</span>,</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_part'</span>,</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_partsupp'</span>,</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_region'</span>,</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_region_avro'</span>,</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_supplier'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> schema <span class="op">=</span> con.get_schema(<span class="st">'functional_alltypes'</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> schema</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>ibis.Schema {</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">id</span>               int32</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  bool_col         boolean</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  tinyint_col      int8</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  smallint_col     int16</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  int_col          int32</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  bigint_col       int64</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  float_col        float32</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>  double_col       float64</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>  date_string_col  string</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>  string_col       string</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>  timestamp_col    timestamp</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>  year             int32</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>  month            int32</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Databases can be created, too, and you can set the storage path in HDFS you want for the data files</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> db <span class="op">=</span> <span class="st">'ibis_testing2'</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.create_database(db, path<span class="op">=</span><span class="st">'/__ibis/my-test-database'</span>, force<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># you may or may not have to give the impala user write and execute permissions to '/__ibis/my-test-database'</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> hdfs.chmod(<span class="st">'/__ibis/my-test-database'</span>, <span class="bn">0o777</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.create_table(<span class="st">'example_table'</span>, con.table(<span class="st">'functional_alltypes'</span>),</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>...                  database<span class="op">=</span>db, force<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Hopefully, there will be data files in the indicated spot in HDFS:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> hdfs.ls(<span class="st">'/__ibis/my-test-database'</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>[<span class="st">'example_table'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To drop a database, including all tables in it, you can use <code>drop_database</code> with <code>force=True</code>:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.drop_database(db, force<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="faster-queries-on-small-data-in-impala" class="level2">
<h2 class="anchored" data-anchor-id="faster-queries-on-small-data-in-impala">Faster queries on small data in Impala</h2>
<p>Since Impala internally uses LLVM to compile parts of queries (aka “codegen”) to make them faster on large data sets there is a certain amount of overhead with running many kinds of queries, even on small datasets. You can disable LLVM code generation when using Ibis, which may significantly speed up queries on smaller datasets:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> numpy.random <span class="im">import</span> rand</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.disable_codegen()</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t <span class="op">=</span> con.table(<span class="st">'ibis_testing.functional_alltypes'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb79"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> time python <span class="at">-c</span> <span class="st">"(t.double_col + rand()).sum().to_pandas()"</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="ex">27.7</span> ms ± 996 µs per loop <span class="er">(</span><span class="ex">mean</span> ± std. dev. of 7 runs, 10 loops each<span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn codegen back on</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>con.disable_codegen(<span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb81"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> time python <span class="at">-c</span> <span class="st">"(t.double_col + rand()).sum().to_pandas()"</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="ex">27</span> ms ± 1.62 ms per loop <span class="er">(</span><span class="ex">mean</span> ± std. dev. of 7 runs, 10 loops each<span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It’s important to remember that codegen is a fixed overhead and will significantly speed up queries on big data</p>
</section>
<section id="user-defined-functions-udf" class="level2">
<h2 class="anchored" data-anchor-id="user-defined-functions-udf">User Defined functions (UDF)</h2>
<p>Impala currently supports user-defined scalar functions (known henceforth as <em>UDFs</em>) and aggregate functions (respectively <em>UDAs</em>) via a C++ extension API.</p>
<p>Initial support for using C++ UDFs in Ibis came in version 0.4.0.</p>
<section id="using-scalar-functions-udfs" class="level3">
<h3 class="anchored" data-anchor-id="using-scalar-functions-udfs">Using scalar functions (UDFs)</h3>
<p>Let’s take an example to illustrate how to make a C++ UDF available to Ibis. Here is a function that computes an approximate equality between floating point values:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"impala_udf/udf.h"</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>BooleanVal FuzzyEquals<span class="op">(</span>FunctionContext<span class="op">*</span> ctx<span class="op">,</span> <span class="at">const</span> DoubleVal<span class="op">&amp;</span> x<span class="op">,</span> <span class="at">const</span> DoubleVal<span class="op">&amp;</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="dt">double</span> EPSILON <span class="op">=</span> <span class="fl">0.000001</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>is_null <span class="op">||</span> y<span class="op">.</span>is_null<span class="op">)</span> <span class="cf">return</span> BooleanVal<span class="op">::</span>null<span class="op">();</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> delta <span class="op">=</span> fabs<span class="op">(</span>x<span class="op">.</span>val <span class="op">-</span> y<span class="op">.</span>val<span class="op">);</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> BooleanVal<span class="op">(</span>delta <span class="op">&lt;</span> EPSILON<span class="op">);</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can compile this to either a shared library (a <code>.so</code> file) or to LLVM bitcode with clang (a <code>.ll</code> file). Skipping that step for now (will add some more detailed instructions here later, promise).</p>
<p>To make this function callable, we use <code>ibis.impala.wrap_udf</code>:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>library <span class="op">=</span> <span class="st">'/ibis/udfs/udftest.ll'</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>inputs <span class="op">=</span> [<span class="st">'double'</span>, <span class="st">'double'</span>]</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> <span class="st">'boolean'</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>symbol <span class="op">=</span> <span class="st">'FuzzyEquals'</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>udf_db <span class="op">=</span> <span class="st">'ibis_testing'</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>udf_name <span class="op">=</span> <span class="st">'fuzzy_equals'</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>fuzzy_equals <span class="op">=</span> ibis.impala.wrap_udf(</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>    library, inputs, output, symbol, name<span class="op">=</span>udf_name</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In typical workflows, you will set up a UDF in Impala once then use it thenceforth. So the <em>first time</em> you do this, you need to create the UDF in Impala:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>client.create_function(fuzzy_equals, database<span class="op">=</span>udf_db)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, we must register this function as a new Impala operation in Ibis. This must take place each time you load your Ibis session.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>func.register(fuzzy_equals.name, udf_db)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The object <code>fuzzy_equals</code> is callable and works with Ibis expressions:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> db <span class="op">=</span> c.database(<span class="st">'ibis_testing'</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t <span class="op">=</span> db.functional_alltypes</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> expr <span class="op">=</span> fuzzy_equals(t.float_col, t.double_col <span class="op">/</span> <span class="dv">10</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> expr.to_pandas()[:<span class="dv">10</span>]</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     <span class="va">True</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="va">False</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="va">False</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="va">False</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="va">False</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    <span class="va">False</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>    <span class="va">False</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>    <span class="va">False</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>    <span class="va">False</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>    <span class="va">False</span></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>Name: tmp, dtype: <span class="bu">bool</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that the call to <code>register</code> on the UDF object must happen each time you use Ibis. If you have a lot of UDFs, I suggest you create a file with all of your wrapper declarations and user APIs that you load with your Ibis session to plug in all your own functions.</p>
</section>
</section>
<section id="working-with-secure-clusters-kerberos" class="level2">
<h2 class="anchored" data-anchor-id="working-with-secure-clusters-kerberos">Working with secure clusters (Kerberos)</h2>
<p>Ibis is compatible with Hadoop clusters that are secured with Kerberos (as well as SSL and LDAP). Note that to enable this support, you’ll also need to install the <code>kerberos</code> package.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> pip install kerberos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Just like the Impala shell and ODBC/JDBC connectors, Ibis connects to Impala through the HiveServer2 interface (using the impyla client). Therefore, the connection semantics are similar to the other access methods for working with secure clusters.</p>
<p>Specifically, after authenticating yourself against Kerberos (e.g., by issuing the appropriate <code>kinit</code> command), simply pass <code>auth_mechanism='GSSAPI'</code> or <code>auth_mechanism='LDAP'</code> (and set <code>kerberos_service_name</code> if necessary along with <code>user</code> and <code>password</code> if necessary) to the <code>ibis.impala_connect(...)</code> method when instantiating an <code>ImpalaConnection</code>. This method also takes arguments to configure SSL (<code>use_ssl</code>, <code>ca_cert</code>). See the documentation for the Impala shell for more details.</p>
<p>Ibis also includes functionality that communicates directly with HDFS, using the WebHDFS REST API. When calling <code>ibis.impala.hdfs_connect(...)</code>, also pass <code>auth_mechanism='GSSAPI'</code> or <code>auth_mechanism='LDAP'</code>, and ensure that you are connecting to the correct port, which may likely be an SSL-secured WebHDFS port. Also note that you can pass <code>verify=False</code> to avoid verifying SSL certificates (which may be helpful in testing). Ibis will assume <code>https</code> when connecting to a Kerberized cluster. Because some Ibis commands create HDFS directories as well as new Impala databases and/or tables, your user will require the necessary privileges.</p>
</section>
<section id="default-configuration-values-for-cdh-components" class="level2">
<h2 class="anchored" data-anchor-id="default-configuration-values-for-cdh-components">Default Configuration Values for CDH Components</h2>
<p>Cloudera CDH ships with HDFS, Impala, Hive and many other components. Sometimes it’s not obvious what default configuration values these tools are using or should be using.</p>
<p>Check out <a href="https://www.cloudera.com/documentation/enterprise/latest/topics/cdh_ig_ports_cdh5.html#topic_9_1">this link</a> to see the default configuration values for every component of CDH.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>