<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Ibis Project - Analysis of Ibis’s CI Performance</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../stylesheets/code_select.css">
<link rel="stylesheet" href="../../stylesheets/extra.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Ibis Project</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../concept/why_ibis.html" rel="" target="">
 <span class="menu-text">Concepts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorial/index.html" rel="" target="">
 <span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../how_to/configuration.html" rel="" target="">
 <span class="menu-text">How-to guides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../reference/index.html" rel="" target="">
 <span class="menu-text">Reference</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../blog/rendered/ibis-version-6.0.0-release.html" rel="" target="" aria-current="page">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../community/index.html" rel="" target="">
 <span class="menu-text">Community</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../release_notes.html" rel="" target="">
 <span class="menu-text">🚧 Release notes</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../blog/rendered/ci-analysis.html">Analysis of Ibis’s CI Performance</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/rendered/ibis-version-6.0.0-release.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ibis v6.0.0</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/rendered/torch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ibis on 🔥: Supercharge Your Workflow with DuckDB and PyTorch</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/rendered/campaign-finance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exploring Campaign Finance Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/ibis-to-file.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ibis Sneak Peek: Writing to Files</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/ibis-examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ibis Sneak Peek: Examples</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/selectors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Maximizing Productivity with Selectors</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/ibis_substrait_to_duckdb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ibis + Substrait + DuckDB</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/ibis-version-4.0.0-release.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ibis v4.0.0</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/rendered/ci-analysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Analysis of Ibis’s CI Performance</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/ffill-and-bfill-using-ibis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>ffill</code> and <code>bfill</code> using Ibis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/Ibis-version-3.1.0-release.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ibis v3.1.0</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/Ibis-version-3.0.0-release.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ibis v3.0.0</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#imports" id="toc-imports" class="nav-link" data-scroll-target="#imports">Imports</a></li>
  <li><a href="#connect-to-bigquery" id="toc-connect-to-bigquery" class="nav-link" data-scroll-target="#connect-to-bigquery">Connect to BigQuery</a></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">Analysis</a>
  <ul class="collapse">
  <li><a href="#terminology" id="toc-terminology" class="nav-link" data-scroll-target="#terminology">Terminology</a></li>
  <li><a href="#whats-in-the-workflows-table" id="toc-whats-in-the-workflows-table" class="nav-link" data-scroll-target="#whats-in-the-workflows-table">What’s in the <code>workflows</code> table?</a></li>
  <li><a href="#whats-in-the-jobs-table" id="toc-whats-in-the-jobs-table" class="nav-link" data-scroll-target="#whats-in-the-jobs-table">What’s in the <code>jobs</code> table?</a></li>
  </ul></li>
  <li><a href="#rationale" id="toc-rationale" class="nav-link" data-scroll-target="#rationale">Rationale</a>
  <ul class="collapse">
  <li><a href="#metrics" id="toc-metrics" class="nav-link" data-scroll-target="#metrics">Metrics</a></li>
  <li><a href="#mitigating-factors" id="toc-mitigating-factors" class="nav-link" data-scroll-target="#mitigating-factors">Mitigating Factors</a></li>
  </ul></li>
  <li><a href="#plot-the-results" id="toc-plot-the-results" class="nav-link" data-scroll-target="#plot-the-results">Plot the Results</a>
  <ul class="collapse">
  <li><a href="#result-1-job-duration" id="toc-result-1-job-duration" class="nav-link" data-scroll-target="#result-1-job-duration">Result #1: Job Duration</a></li>
  <li><a href="#result-2-workflow-duration-and-queueing-time" id="toc-result-2-workflow-duration-and-queueing-time" class="nav-link" data-scroll-target="#result-2-workflow-duration-and-queueing-time">Result #2: Workflow Duration and Queueing Time</a>
  <ul class="collapse">
  <li><a href="#queueing-time" id="toc-queueing-time" class="nav-link" data-scroll-target="#queueing-time">Queueing Time</a></li>
  <li><a href="#workflow-duration" id="toc-workflow-duration" class="nav-link" data-scroll-target="#workflow-duration">Workflow Duration</a></li>
  </ul></li>
  <li><a href="#result-3-workflow-duration-and-queueing-duration-are-correlated" id="toc-result-3-workflow-duration-and-queueing-duration-are-correlated" class="nav-link" data-scroll-target="#result-3-workflow-duration-and-queueing-duration-are-correlated">Result #3: Workflow Duration and Queueing Duration are correlated</a></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Analysis of Ibis’s CI Performance</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>This notebook takes you through an analysis of Ibis’s CI data using ibis on top of <a href="https://cloud.google.com/bigquery">Google BigQuery</a>.</p>
<ul>
<li>First, we load some data and poke around at it to see what’s what.</li>
<li>Second, we figure out some useful things to calculate based on our poking.</li>
<li>Third, we’ll visualize the results of calculations to showcase what changed and how.</li>
</ul>
</section>
<section id="imports" class="level2">
<h2 class="anchored" data-anchor-id="imports">Imports</h2>
<p>Let’s start out by importing ibis and turning on interactive mode.</p>
<div class="cell" data-tags="[]" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ibis</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ibis <span class="im">import</span> _</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>ibis.options.interactive <span class="op">=</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="connect-to-bigquery" class="level2">
<h2 class="anchored" data-anchor-id="connect-to-bigquery">Connect to BigQuery</h2>
<p>We connect to BigQuery using the <code>ibis.connect</code> API, which accepts a URL string indicating the backend and various bit of information needed to connect to the backend. Here we’re using BigQuery, so we need the project id (<code>ibis-gbq</code>) and the dataset id (<code>workflows</code>).</p>
<p>Datasets are analogous to schemas in other systems.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"bigquery://ibis-gbq/workflows"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>con <span class="op">=</span> ibis.<span class="ex">connect</span>(url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see what tables are available.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>con.list_tables()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>['analysis', 'jobs', 'workflows']</code></pre>
</div>
</div>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis">Analysis</h2>
<p>Here we’ve got our first bit of interesting information: the <code>jobs</code> and <code>workflows</code> tables.</p>
<section id="terminology" class="level3">
<h3 class="anchored" data-anchor-id="terminology">Terminology</h3>
<p>Before we jump in, it helps to lay down some terminology.</p>
<ul>
<li>A <strong>workflow</strong> corresponds to an individual GitHub Actions YAML file in a GitHub repository under the <code>.github/workflows</code> directory.</li>
<li>A <strong>job</strong> is a named set of steps to run inside a <strong>workflow</strong> file.</li>
</ul>
</section>
<section id="whats-in-the-workflows-table" class="level3">
<h3 class="anchored" data-anchor-id="whats-in-the-workflows-table">What’s in the <code>workflows</code> table?</h3>
<p>Each row in the <code>workflows</code> table corresponds to a <strong>workflow run</strong>.</p>
<ul>
<li>A <strong>workflow run</strong> is an instance of a workflow that was triggered by some entity: a GitHub user, bot, or other entity. Each row of the <code>workflows</code> table is a <strong>workflow run</strong>.</li>
</ul>
</section>
<section id="whats-in-the-jobs-table" class="level3">
<h3 class="anchored" data-anchor-id="whats-in-the-jobs-table">What’s in the <code>jobs</code> table?</h3>
<p>Similarly, each row in the <code>jobs</code> table is a <strong>job run</strong>. That is, for a given <strong>workflow run</strong> there are a set of jobs run with it.</p>
<ul>
<li>A <strong>job run</strong> is an instance of a job <em>in a workflow</em>. It is associated with a single <strong>workflow run</strong>.</li>
</ul>
</section>
</section>
<section id="rationale" class="level2">
<h2 class="anchored" data-anchor-id="rationale">Rationale</h2>
<p>The goal of this analysis is to try to understand ibis’s CI performance, and whether the amount of time we spent waiting on CI has decreased, stayed the same or increased. Ideally, we can understand the pieces that contribute to the change or lack thereof.</p>
<section id="metrics" class="level3">
<h3 class="anchored" data-anchor-id="metrics">Metrics</h3>
<p>To that end there are a few interesting metrics to look at:</p>
<ul>
<li><strong>job run</strong> <em>duration</em>: this is the amount of time it takes for a given job to complete</li>
<li><strong>workflow run</strong> <em>duration</em>: the amount of time it takes for <em>all</em> job runs in a workflow run to complete.</li>
<li><strong>queueing</strong> <em>duration</em>: the amount time time spent waiting for the <em>first</em> job run to commence.</li>
</ul>
</section>
<section id="mitigating-factors" class="level3">
<h3 class="anchored" data-anchor-id="mitigating-factors">Mitigating Factors</h3>
<ul>
<li>Around October 2021, we changed our CI infrastructure to use <a href="https://python-poetry.org/">Poetry</a> instead of <a href="https://docs.conda.io/en/latest/">Conda</a>. The goal there was to see if we could cache dependencies using the lock file generated by poetry. We should see whether that had any effect.</li>
<li>At the end of November 2022, we switch to the Team Plan (a paid GitHub plan) for the Ibis organzation. This tripled the amount of <strong>job runs</strong> that could execute in parallel. We should see if that helped anything.</li>
</ul>
<p>Alright, let’s jump into some data!</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>jobs <span class="op">=</span> con.tables.jobs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>jobs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━┓
┃<span style="font-weight: bold"> url                       </span>┃<span style="font-weight: bold"> steps                     </span>┃<span style="font-weight: bold"> status    </span>┃<span style="font-weight: bold"> started_at          </span>┃<span style="font-weight: bold"> runner_group_name </span>┃<span style="font-weight: bold"> … </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━┩
│                           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;struct&lt;status: </span>     │           │                     │                   │   │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string, conclusion: </span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│                           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string, started_at: </span>      │           │                     │                   │   │
│                           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp, number:…</span>       │           │                     │                   │   │
├───────────────────────────┼───────────────────────────┼───────────┼─────────────────────┼───────────────────┼───┤
│ https://api.github.com/r… │ <span style="font-weight: bold">[{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="font-weight: bold">{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12</span><span style="font-weight: bold">]</span>   │ completed │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:54:37</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │ <span style="font-weight: bold">[{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="font-weight: bold">{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span><span style="font-weight: bold">]</span>    │ completed │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:54:37</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │ <span style="font-weight: bold">[{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="font-weight: bold">{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span><span style="font-weight: bold">]</span>    │ completed │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:51:54</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │ <span style="font-weight: bold">[{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="font-weight: bold">{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12</span><span style="font-weight: bold">]</span>   │ completed │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:51:53</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │ <span style="font-weight: bold">[{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="font-weight: bold">{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11</span><span style="font-weight: bold">]</span>   │ completed │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:50:19</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │ <span style="font-weight: bold">[{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="font-weight: bold">{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span><span style="font-weight: bold">]</span>    │ completed │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:50:20</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │ <span style="font-weight: bold">[{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="font-weight: bold">{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span><span style="font-weight: bold">]</span>    │ completed │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:39:58</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │ <span style="font-weight: bold">[{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="font-weight: bold">{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9</span><span style="font-weight: bold">]</span>    │ completed │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:39:57</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │ <span style="font-weight: bold">[{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="font-weight: bold">{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9</span><span style="font-weight: bold">]</span>    │ completed │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:34:19</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │ <span style="font-weight: bold">[{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="font-weight: bold">{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span><span style="font-weight: bold">]</span>    │ completed │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:34:19</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────────────────────┴───────────────────────────┴───────────┴─────────────────────┴───────────────────┴───┘
</pre>
</div>
</div>
<p>These first few columns in the <code>jobs</code> table aren’t that interesting so we should look at what else is there</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>jobs.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>['url',
 'steps',
 'status',
 'started_at',
 'runner_group_name',
 'run_attempt',
 'name',
 'labels',
 'node_id',
 'id',
 'runner_id',
 'run_url',
 'run_id',
 'check_run_url',
 'html_url',
 'runner_name',
 'runner_group_id',
 'head_sha',
 'conclusion',
 'completed_at']</code></pre>
</div>
</div>
<p>A bunch of these aren’t that useful for our purposes. However, <code>run_id</code>, <code>started_at</code>, <code>completed_at</code> are useful for us. The <a href="https://docs.github.com/en/rest/actions/workflow-jobs?apiVersion=2022-11-28#get-a-job-for-a-workflow-run">GitHub documentation for job information</a> provides useful detail about the meaning of these fields.</p>
<ul>
<li><code>run_id</code>: the workflow run associated with this job run</li>
<li><code>started_at</code>: when the job started</li>
<li><code>completed_at</code>: when the job completed</li>
</ul>
<p>What we’re interested in to a first degree is the job duration, so let’s compute that.</p>
<p>We also need to compute when the last job for a given <code>run_id</code> started and when it completed. We’ll use the former to compute the queueing duration, and the latter to compute the total time it took for a given workflow run to complete.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>run_id_win <span class="op">=</span> ibis.window(group_by<span class="op">=</span>_.run_id)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>jobs <span class="op">=</span> jobs.select(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    _.run_id,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    job_duration<span class="op">=</span>_.completed_at.cast(<span class="st">"int"</span>) <span class="op">-</span> _.started_at.cast(<span class="st">"int"</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    last_job_started_at<span class="op">=</span>_.started_at.<span class="bu">max</span>().over(run_id_win),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    last_job_completed_at<span class="op">=</span>_.completed_at.<span class="bu">max</span>().over(run_id_win),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>jobs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> run_id    </span>┃<span style="font-weight: bold"> job_duration </span>┃<span style="font-weight: bold"> last_job_started_at </span>┃<span style="font-weight: bold"> last_job_completed_at </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>             │
├───────────┼──────────────┼─────────────────────┼───────────────────────┤
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">199092057</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3148000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-07 11:24:05</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-07 12:16:33</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">202720732</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">68000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-10 15:42:13</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-10 16:31:20</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">202720732</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2947000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-10 15:42:13</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-10 16:31:20</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">240931982</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">943000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-09-05 20:52:43</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-09-05 20:52:43</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">240931982</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">648000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-09-05 20:52:43</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-09-05 20:52:43</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">240931982</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">562000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-09-05 20:52:43</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-09-05 20:52:43</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">240931982</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">421000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-09-05 20:52:43</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-09-05 20:52:43</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">240931982</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">469000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-09-05 20:52:43</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-09-05 20:52:43</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">240931982</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3244000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-09-05 20:52:43</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-09-05 20:52:43</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">240931982</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-09-05 20:52:43</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-09-05 20:52:43</span>   │
│         <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                     │
└───────────┴──────────────┴─────────────────────┴───────────────────────┘
</pre>
</div>
</div>
<p>Let’s take a look at <code>workflows</code></p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>workflows <span class="op">=</span> con.tables.workflows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>workflows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━┓
┃<span style="font-weight: bold"> workflow_url              </span>┃<span style="font-weight: bold"> workflow_id </span>┃<span style="font-weight: bold"> triggering_actor </span>┃<span style="font-weight: bold"> run_number </span>┃<span style="font-weight: bold"> run_attempt </span>┃<span style="font-weight: bold"> updated_at          </span>┃<span style="font-weight: bold"> … </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">struct&lt;subscrip…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
├───────────────────────────┼─────────────┼──────────────────┼────────────┼─────────────┼─────────────────────┼───┤
│ https://api.github.com/r… │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2100986</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">13</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:57:03</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2100986</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:55:08</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2100986</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:52:58</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2100986</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:42:41</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2100986</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:36:32</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2100986</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:31:43</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2100986</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:19:50</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2100986</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:14:16</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2100986</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:05:14</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ https://api.github.com/r… │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2100986</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">∅</span>                │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:01:32</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                         │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────────────────────┴─────────────┴──────────────────┴────────────┴─────────────┴─────────────────────┴───┘
</pre>
</div>
</div>
<p>Again we have a bunch of columns that aren’t so useful to us, so let’s see what else is there.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>workflows.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>['workflow_url',
 'workflow_id',
 'triggering_actor',
 'run_number',
 'run_attempt',
 'updated_at',
 'cancel_url',
 'rerun_url',
 'check_suite_node_id',
 'pull_requests',
 'id',
 'node_id',
 'status',
 'repository',
 'jobs_url',
 'previous_attempt_url',
 'artifacts_url',
 'html_url',
 'head_sha',
 'head_repository',
 'run_started_at',
 'head_branch',
 'url',
 'event',
 'name',
 'actor',
 'created_at',
 'check_suite_url',
 'check_suite_id',
 'conclusion',
 'head_commit',
 'logs_url']</code></pre>
</div>
</div>
<p>We don’t care about many of these for the purposes of this analysis, however we need the <code>id</code> and a few values derived from the <code>run_started_at</code> column.</p>
<ul>
<li><code>id</code>: the unique identifier of the <strong>workflow run</strong></li>
<li><code>run_started_at</code>: the time the workflow run started</li>
</ul>
<p>We compute the date the run started at so we can later compare it to the dates where we added poetry and switched to the team plan.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>workflows <span class="op">=</span> workflows.select(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    _.<span class="bu">id</span>, _.run_started_at, started_date<span class="op">=</span>_.run_started_at.date()</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>workflows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> id        </span>┃<span style="font-weight: bold"> run_started_at      </span>┃<span style="font-weight: bold"> started_date </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">date</span>         │
├───────────┼─────────────────────┼──────────────┤
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195478382</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:54:29</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195476517</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:51:44</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195475525</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:50:11</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195468677</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:39:51</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195465343</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:34:11</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195460611</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:29:07</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195452505</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:17:29</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195447886</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:11:35</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195435521</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:02:34</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04</span>   │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195433385</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04 23:01:00</span> │ <span style="color: #800080; text-decoration-color: #800080">2020-08-04</span>   │
│         <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>            │
└───────────┴─────────────────────┴──────────────┘
</pre>
</div>
</div>
<p>We need to associate jobs and workflows somehow, so let’s join them on the relevant key fields.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>joined <span class="op">=</span> jobs.join(workflows, jobs.run_id <span class="op">==</span> workflows.<span class="bu">id</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>joined</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━┓
┃<span style="font-weight: bold"> run_id    </span>┃<span style="font-weight: bold"> job_duration </span>┃<span style="font-weight: bold"> last_job_started_at </span>┃<span style="font-weight: bold"> last_job_completed_at </span>┃<span style="font-weight: bold"> id        </span>┃<span style="font-weight: bold"> run_started_at      </span>┃<span style="font-weight: bold"> … </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
├───────────┼──────────────┼─────────────────────┼───────────────────────┼───────────┼─────────────────────┼───┤
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637414690</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 23:40:16</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 23:40:16</span>   │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637414690</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 22:59:31</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2146000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 23:38:33</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-10 00:17:30</span>   │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 22:58:27</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1329000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 23:38:33</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-10 00:17:30</span>   │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 22:58:27</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2979000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 23:38:33</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-10 00:17:30</span>   │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 22:58:27</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1527000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 23:38:33</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-10 00:17:30</span>   │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 22:58:27</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1585000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 23:38:33</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-10 00:17:30</span>   │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 22:58:27</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">985000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 23:38:33</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-10 00:17:30</span>   │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 22:58:27</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2455000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 23:38:33</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-10 00:17:30</span>   │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 22:58:27</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1305000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 23:38:33</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-10 00:17:30</span>   │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 22:58:27</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1015000000</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 23:38:33</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-10 00:17:30</span>   │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637412930</span> │ <span style="color: #800080; text-decoration-color: #800080">2021-03-09 22:58:27</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│         <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                     │         <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────┴──────────────┴─────────────────────┴───────────────────────┴───────────┴─────────────────────┴───┘
</pre>
</div>
</div>
<p>Sweet! Now we have workflow runs and job runs together in the same table, let’s start exploring summarization.</p>
<p>Let’s encode our knowledge about when the poetry move happened and also when we moved to the team plan.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>POETRY_MERGED_DATE <span class="op">=</span> date(<span class="dv">2021</span>, <span class="dv">10</span>, <span class="dv">15</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>TEAMIZATION_DATE <span class="op">=</span> date(<span class="dv">2022</span>, <span class="dv">11</span>, <span class="dv">28</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s compute some indicator variables indicating whether a given row contains data after poetry changes occurred, and do the same for the team plan.</p>
<p>Let’s also compute queueing time and workflow duration.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> joined.select(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    _.started_date,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    _.job_duration,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    has_poetry<span class="op">=</span>_.started_date <span class="op">&gt;</span> POETRY_MERGED_DATE,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    has_team<span class="op">=</span>_.started_date <span class="op">&gt;</span> TEAMIZATION_DATE,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    queueing_time<span class="op">=</span>_.last_job_started_at.cast(<span class="st">"int"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span> _.run_started_at.cast(<span class="st">"int"</span>),</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    workflow_duration<span class="op">=</span>_.last_job_completed_at.cast(<span class="st">"int"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span> _.run_started_at.cast(<span class="st">"int"</span>),</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>stats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> started_date </span>┃<span style="font-weight: bold"> job_duration </span>┃<span style="font-weight: bold"> has_poetry </span>┃<span style="font-weight: bold"> has_team </span>┃<span style="font-weight: bold"> queueing_time </span>┃<span style="font-weight: bold"> workflow_duration </span>┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">date</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">boolean</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">boolean</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │
├──────────────┼──────────────┼────────────┼──────────┼───────────────┼───────────────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-02</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">286000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">823000000</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-02</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">274000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">823000000</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-02</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">397000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">823000000</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-02</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">394000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">823000000</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-02</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">709000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">823000000</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-02</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">760000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">823000000</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-02</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">717000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">823000000</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-02</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">419000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">823000000</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-02</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">503000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">823000000</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-02</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">811000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">823000000</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>            │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>        │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└──────────────┴──────────────┴────────────┴──────────┴───────────────┴───────────────────┘
</pre>
</div>
</div>
<p>Let’s create a column ranging from 0 to 2 inclusive where:</p>
<ul>
<li>0: no improvements</li>
<li>1: just poetry</li>
<li>2: poetry and the team plan</li>
</ul>
<p>Let’s also give them some names that’ll look nice on our plots.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> stats.mutate(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    raw_improvements<span class="op">=</span>_.has_poetry.cast(<span class="st">"int"</span>) <span class="op">+</span> _.has_team.cast(<span class="st">"int"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>).mutate(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    improvements<span class="op">=</span>(</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        _.raw_improvements.case()</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        .when(<span class="dv">0</span>, <span class="st">"None"</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        .when(<span class="dv">1</span>, <span class="st">"Poetry"</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        .when(<span class="dv">2</span>, <span class="st">"Poetry + Team Plan"</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        .else_(<span class="st">"NA"</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        .end()</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    team_plan<span class="op">=</span>ibis.where(_.raw_improvements <span class="op">&gt;</span> <span class="dv">1</span>, <span class="st">"Poetry + Team Plan"</span>, <span class="st">"None"</span>),</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>stats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━┓
┃<span style="font-weight: bold"> started_date </span>┃<span style="font-weight: bold"> job_duration </span>┃<span style="font-weight: bold"> has_poetry </span>┃<span style="font-weight: bold"> has_team </span>┃<span style="font-weight: bold"> queueing_time </span>┃<span style="font-weight: bold"> workflow_duration </span>┃<span style="font-weight: bold"> raw_improvements </span>┃<span style="font-weight: bold"> … </span>┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">date</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">boolean</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">boolean</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
├──────────────┼──────────────┼────────────┼──────────┼───────────────┼───────────────────┼──────────────────┼───┤
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-22</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">388000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">850000000</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-22</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">392000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">850000000</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-22</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">502000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">850000000</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-22</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">515000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">850000000</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-22</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">392000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">850000000</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-22</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">341000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">850000000</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-22</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">743000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">850000000</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-22</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">630000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">850000000</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-22</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">750000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">850000000</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-22</span>   │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">777000000</span> │ False      │ False    │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21000000</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">850000000</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>            │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>        │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└──────────────┴──────────────┴────────────┴──────────┴───────────────┴───────────────────┴──────────────────┴───┘
</pre>
</div>
</div>
<p>Finally, we can summarize by averaging the different durations, grouping on the variables of interest.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>USECS_PER_MIN <span class="op">=</span> <span class="dv">60_000_000</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>agged <span class="op">=</span> stats.group_by([_.started_date, _.improvements, _.team_plan]).agg(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    job<span class="op">=</span>_.job_duration.div(USECS_PER_MIN).mean(),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    workflow<span class="op">=</span>_.workflow_duration.div(USECS_PER_MIN).mean(),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    queueing_time<span class="op">=</span>_.queueing_time.div(USECS_PER_MIN).mean(),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>agged</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> started_date </span>┃<span style="font-weight: bold"> improvements </span>┃<span style="font-weight: bold"> team_plan </span>┃<span style="font-weight: bold"> job       </span>┃<span style="font-weight: bold"> workflow  </span>┃<span style="font-weight: bold"> queueing_time </span>┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">date</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │
├──────────────┼──────────────┼───────────┼───────────┼───────────┼───────────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2021-11-08</span>   │ Poetry       │ None      │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5.076520</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25.813687</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.095093</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2022-05-09</span>   │ Poetry       │ None      │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.645870</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.563438</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">15.305701</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2022-06-04</span>   │ Poetry       │ None      │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.641251</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12.041645</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10.759055</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2022-07-21</span>   │ Poetry       │ None      │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.236880</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">13.001932</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12.147463</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2020-12-15</span>   │ None         │ None      │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">13.788721</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.767340</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.767340</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-08-17</span>   │ None         │ None      │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8.777027</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">22.233333</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7.607057</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-09-23</span>   │ None         │ None      │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11.531302</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">93.434379</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">93.059946</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2020-09-01</span>   │ None         │ None      │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">15.639095</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.154527</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">58.680453</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-06-24</span>   │ None         │ None      │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8.442157</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">13.697059</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.197059</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2021-01-07</span>   │ None         │ None      │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12.555856</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">48.162613</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">47.651351</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │         <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │         <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└──────────────┴──────────────┴───────────┴───────────┴───────────┴───────────────┘
</pre>
</div>
</div>
<p>If at any point you want to inspect the SQL you’ll be running, ibis has you covered with <code>ibis.to_sql</code>.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> ibis.to_sql(agged)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>sql</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div class="sourceCode" id="cb21"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  t0.`started_date`,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  t0.`improvements`,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  t0.`team_plan`,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">AVG</span>(IEEE_DIVIDE(t0.`job_duration`, <span class="dv">60000000</span>)) <span class="kw">AS</span> `job`,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">AVG</span>(IEEE_DIVIDE(t0.`workflow_duration`, <span class="dv">60000000</span>)) <span class="kw">AS</span> `workflow`,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">AVG</span>(IEEE_DIVIDE(t0.`queueing_time`, <span class="dv">60000000</span>)) <span class="kw">AS</span> `queueing_time`</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> (</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    t1.<span class="op">*</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">CASE</span> t1.`raw_improvements`</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>      <span class="cf">WHEN</span> <span class="dv">0</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">THEN</span> <span class="st">'None'</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">WHEN</span> <span class="dv">1</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">THEN</span> <span class="st">'Poetry'</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">WHEN</span> <span class="dv">2</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>      <span class="cf">THEN</span> <span class="st">'Poetry + Team Plan'</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">ELSE</span> <span class="st">'NA'</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">END</span> <span class="kw">AS</span> `improvements`,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">CASE</span> <span class="cf">WHEN</span> t1.`raw_improvements` <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">THEN</span> <span class="st">'Poetry + Team Plan'</span> <span class="cf">ELSE</span> <span class="st">'None'</span> <span class="cf">END</span> <span class="kw">AS</span> `team_plan`</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> (</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>      t2.<span class="op">*</span>,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">CAST</span>(t2.`has_poetry` <span class="kw">AS</span> INT64) <span class="op">+</span> <span class="fu">CAST</span>(t2.`has_team` <span class="kw">AS</span> INT64) <span class="kw">AS</span> `raw_improvements`</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> (</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>      <span class="kw">SELECT</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>        `started_date`,</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>        `job_duration`,</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>        `started_date` <span class="op">&gt;</span> <span class="fu">CAST</span>(<span class="st">'2021-10-15'</span> <span class="kw">AS</span> <span class="dt">DATE</span>) <span class="kw">AS</span> `has_poetry`,</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>        `started_date` <span class="op">&gt;</span> <span class="fu">CAST</span>(<span class="st">'2022-11-28'</span> <span class="kw">AS</span> <span class="dt">DATE</span>) <span class="kw">AS</span> `has_team`,</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>        UNIX_MICROS(`last_job_started_at`) <span class="op">-</span> UNIX_MICROS(`run_started_at`) <span class="kw">AS</span> `queueing_time`,</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>        UNIX_MICROS(`last_job_completed_at`) <span class="op">-</span> UNIX_MICROS(`run_started_at`) <span class="kw">AS</span> `workflow_duration`</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>      <span class="kw">FROM</span> (</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">SELECT</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>          t5.`run_id`,</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>          UNIX_MICROS(t5.`completed_at`) <span class="op">-</span> UNIX_MICROS(t5.`started_at`) <span class="kw">AS</span> `job_duration`,</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>          <span class="fu">MAX</span>(t5.`started_at`) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> t5.`run_id`) <span class="kw">AS</span> `last_job_started_at`,</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>          <span class="fu">MAX</span>(t5.`completed_at`) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> t5.`run_id`) <span class="kw">AS</span> `last_job_completed_at`</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">FROM</span> `ibis<span class="op">-</span>gbq.workflows.jobs` <span class="kw">AS</span> t5</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>      ) <span class="kw">AS</span> t3</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>      <span class="kw">INNER</span> <span class="kw">JOIN</span> (</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>        <span class="kw">SELECT</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>          t5.`id`,</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>          t5.`run_started_at`,</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>          <span class="dt">DATE</span>(t5.`run_started_at`) <span class="kw">AS</span> `started_date`</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>        <span class="kw">FROM</span> `ibis<span class="op">-</span>gbq.workflows.workflows` <span class="kw">AS</span> t5</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>      ) <span class="kw">AS</span> t4</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>        <span class="kw">ON</span> t3.`run_id` <span class="op">=</span> t4.`id`</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>    ) <span class="kw">AS</span> t2</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="kw">AS</span> t1</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>) <span class="kw">AS</span> t0</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>,</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>,</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
</section>
<section id="plot-the-results" class="level1">
<h1>Plot the Results</h1>
<p>Ibis doesn’t have builtin plotting support, so we need to pull our results into pandas.</p>
<p>Here I’m using <code>plotnine</code> (a Python port of <code>ggplot2</code>), which has great integration with pandas DataFrames.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>raw_df <span class="op">=</span> agged.execute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>raw_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">started_date</th>
<th data-quarto-table-cell-role="th">improvements</th>
<th data-quarto-table-cell-role="th">team_plan</th>
<th data-quarto-table-cell-role="th">job</th>
<th data-quarto-table-cell-role="th">workflow</th>
<th data-quarto-table-cell-role="th">queueing_time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2020-10-24</td>
<td>None</td>
<td>None</td>
<td>12.366667</td>
<td>54.710606</td>
<td>54.709091</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2021-03-09</td>
<td>None</td>
<td>None</td>
<td>28.335816</td>
<td>52.688830</td>
<td>10.635284</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2022-01-04</td>
<td>Poetry</td>
<td>None</td>
<td>3.288468</td>
<td>20.827914</td>
<td>20.684298</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2021-09-30</td>
<td>None</td>
<td>None</td>
<td>7.993065</td>
<td>52.552629</td>
<td>51.354530</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2022-09-14</td>
<td>Poetry</td>
<td>None</td>
<td>3.855526</td>
<td>29.760230</td>
<td>27.029778</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">801</td>
<td>2020-11-17</td>
<td>None</td>
<td>None</td>
<td>12.460078</td>
<td>40.966512</td>
<td>30.366744</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">802</td>
<td>2022-11-06</td>
<td>Poetry</td>
<td>None</td>
<td>3.937369</td>
<td>19.095751</td>
<td>16.830617</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">803</td>
<td>2020-09-23</td>
<td>None</td>
<td>None</td>
<td>12.086594</td>
<td>44.403986</td>
<td>43.983152</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">804</td>
<td>2020-08-28</td>
<td>None</td>
<td>None</td>
<td>15.834127</td>
<td>60.183333</td>
<td>60.183333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">805</td>
<td>2021-09-05</td>
<td>None</td>
<td>None</td>
<td>6.944340</td>
<td>18.912736</td>
<td>12.630189</td>
</tr>
</tbody>
</table>

<p>806 rows × 6 columns</p>
</div>
</div>
</div>
<p>Generally, <code>plotnine</code> works with long, tidy data so let’s use <code>pandas.melt</code> to get there.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.melt(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    raw_df,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    id_vars<span class="op">=</span>[<span class="st">"started_date"</span>, <span class="st">"improvements"</span>, <span class="st">"team_plan"</span>],</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    var_name<span class="op">=</span><span class="st">"entity"</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    value_name<span class="op">=</span><span class="st">"duration"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">started_date</th>
<th data-quarto-table-cell-role="th">improvements</th>
<th data-quarto-table-cell-role="th">team_plan</th>
<th data-quarto-table-cell-role="th">entity</th>
<th data-quarto-table-cell-role="th">duration</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2020-10-24</td>
<td>None</td>
<td>None</td>
<td>job</td>
<td>12.366667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2021-03-09</td>
<td>None</td>
<td>None</td>
<td>job</td>
<td>28.335816</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2022-01-04</td>
<td>Poetry</td>
<td>None</td>
<td>job</td>
<td>3.288468</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2021-09-30</td>
<td>None</td>
<td>None</td>
<td>job</td>
<td>7.993065</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2022-09-14</td>
<td>Poetry</td>
<td>None</td>
<td>job</td>
<td>3.855526</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s make our theme lighthearted by using <code>xkcd</code>-style plots.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>theme_set(theme_xkcd())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a few labels for our plot.</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>poetry_label <span class="op">=</span> <span class="ss">f"Poetry</span><span class="ch">\n</span><span class="sc">{</span>POETRY_MERGED_DATE<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>team_label <span class="op">=</span> <span class="ss">f"Team Plan</span><span class="ch">\n</span><span class="sc">{</span>TEAMIZATION_DATE<span class="sc">}</span><span class="ss">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Without the following line you may see large amount of inconsequential warnings that make the notebook unusable.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># without this, findfont logging spams the notebook making it unusable</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>logging.getLogger(<span class="st">'matplotlib.font_manager'</span>).disabled <span class="op">=</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we show job durations, coloring the points differently depending on whether they have no improvements, poetry, or poetry + team plan.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    ggplot(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>        df.loc[df.entity <span class="op">==</span> <span class="st">"job"</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>        aes(x<span class="op">=</span><span class="st">"started_date"</span>, y<span class="op">=</span><span class="st">"duration"</span>, color<span class="op">=</span><span class="st">"factor(improvements)"</span>),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_point()</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_vline(</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        xintercept<span class="op">=</span>[TEAMIZATION_DATE, POETRY_MERGED_DATE],</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        colour<span class="op">=</span>[<span class="st">"blue"</span>, <span class="st">"green"</span>],</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        linetype<span class="op">=</span><span class="st">"dashed"</span>,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> scale_color_brewer(</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>        palette<span class="op">=</span><span class="dv">7</span>,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">type</span><span class="op">=</span><span class="st">'qual'</span>,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>        limits<span class="op">=</span>[<span class="st">"None"</span>, <span class="st">"Poetry"</span>, <span class="st">"Poetry + Team Plan"</span>],</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_text(x<span class="op">=</span>POETRY_MERGED_DATE, label<span class="op">=</span>poetry_label, y<span class="op">=</span><span class="dv">15</span>, color<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_text(x<span class="op">=</span>TEAMIZATION_DATE, label<span class="op">=</span>team_label, y<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> stat_smooth(method<span class="op">=</span><span class="st">"lm"</span>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs(x<span class="op">=</span><span class="st">"Date"</span>, y<span class="op">=</span><span class="st">"Duration (minutes)"</span>)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> ggtitle(<span class="st">"Job Duration"</span>)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> theme(</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>        figure_size<span class="op">=</span>(<span class="dv">22</span>, <span class="dv">6</span>),</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>        legend_position<span class="op">=</span>(<span class="fl">0.67</span>, <span class="fl">0.65</span>),</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>        legend_direction<span class="op">=</span><span class="st">"vertical"</span>,</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="ci-analysis_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="result-1-job-duration" class="level2">
<h2 class="anchored" data-anchor-id="result-1-job-duration">Result #1: Job Duration</h2>
<p>This result is pretty interesting.</p>
<p>A few things pop out to me right away:</p>
<ul>
<li>The move to poetry decreased the average job run duration by quite a bit. No, I’m not going to do any statistical tests.</li>
<li>The variability of job run durations also decreased by quite a bit after introducing poetry.</li>
<li>Moving to the team plan had little to no effect on job run duration.</li>
</ul>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    ggplot(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>        df.loc[df.entity <span class="op">!=</span> <span class="st">"job"</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>        aes(x<span class="op">=</span><span class="st">"started_date"</span>, y<span class="op">=</span><span class="st">"duration"</span>, color<span class="op">=</span><span class="st">"factor(improvements)"</span>),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> facet_wrap(<span class="st">"entity"</span>, ncol<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_point()</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_vline(</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        xintercept<span class="op">=</span>[TEAMIZATION_DATE, POETRY_MERGED_DATE],</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        linetype<span class="op">=</span><span class="st">"dashed"</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> scale_color_brewer(</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>        palette<span class="op">=</span><span class="dv">7</span>,</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">type</span><span class="op">=</span><span class="st">'qual'</span>,</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>        limits<span class="op">=</span>[<span class="st">"None"</span>, <span class="st">"Poetry"</span>, <span class="st">"Poetry + Team Plan"</span>],</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_text(x<span class="op">=</span>POETRY_MERGED_DATE, label<span class="op">=</span>poetry_label, y<span class="op">=</span><span class="dv">75</span>, color<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_text(x<span class="op">=</span>TEAMIZATION_DATE, label<span class="op">=</span>team_label, y<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> stat_smooth(method<span class="op">=</span><span class="st">"lm"</span>)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs(x<span class="op">=</span><span class="st">"Date"</span>, y<span class="op">=</span><span class="st">"Duration (minutes)"</span>)</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> ggtitle(<span class="st">"Workflow Duration"</span>)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> theme(</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>        figure_size<span class="op">=</span>(<span class="dv">22</span>, <span class="dv">13</span>),</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>        legend_position<span class="op">=</span>(<span class="fl">0.68</span>, <span class="fl">0.75</span>),</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>        legend_direction<span class="op">=</span><span class="st">"vertical"</span>,</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="ci-analysis_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="result-2-workflow-duration-and-queueing-time" class="level2">
<h2 class="anchored" data-anchor-id="result-2-workflow-duration-and-queueing-time">Result #2: Workflow Duration and Queueing Time</h2>
<p>Another interesting result.</p>
<section id="queueing-time" class="level3">
<h3 class="anchored" data-anchor-id="queueing-time">Queueing Time</h3>
<ul>
<li>It almost looks like moving to poetry made average queueing time worse. This is probably due to our perception that faster jobs means faster ci. As we see here that isn’t the case</li>
<li>Moving to the team plan cut down the queueing time by quite a bit</li>
</ul>
</section>
<section id="workflow-duration" class="level3">
<h3 class="anchored" data-anchor-id="workflow-duration">Workflow Duration</h3>
<ul>
<li>Overall workflow duration appears to be strongly influenced by moving to the team plan, which is almost certainly due to the drop in queueing time since we are no longer limited by slow job durations.</li>
<li>Perhaps it’s obvious, but queueing time and workflow duration appear to be highly correlated.</li>
</ul>
<p>In the next plot we’ll look at that correlation.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    ggplot(raw_df, aes(x<span class="op">=</span><span class="st">"workflow"</span>, y<span class="op">=</span><span class="st">"queueing_time"</span>))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_point()</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_rug()</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> facet_grid(<span class="st">". ~ team_plan"</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs(x<span class="op">=</span><span class="st">"Workflow Duration (minutes)"</span>, y<span class="op">=</span><span class="st">"Queueing Time (minutes)"</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> ggtitle(<span class="st">"Workflow Duration vs. Queueing Time"</span>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> theme(figure_size<span class="op">=</span>(<span class="dv">22</span>, <span class="dv">6</span>))</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="ci-analysis_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="result-3-workflow-duration-and-queueing-duration-are-correlated" class="level2">
<h2 class="anchored" data-anchor-id="result-3-workflow-duration-and-queueing-duration-are-correlated">Result #3: Workflow Duration and Queueing Duration are correlated</h2>
<p>It also seems that moving to the team plan (though also the move to poetry might be related here) reduced the variability of both metrics.</p>
<p>We’re lacking data compared to the past so we should wait for more to come in.</p>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>It appears that you need both a short queue time <strong>and</strong> fast individual jobs to minimize time spent in CI.</p>
<p>If you have a short queue time, but long job runs then you’ll be bottlenecked on individual jobs, and if you have more jobs than queue slots then you’ll be blocked on queueing time.</p>
<p>I think we can sum this up nicely:</p>
<ul>
<li>slow jobs, slow queue: 🤷 blocked by jobs or queue</li>
<li>slow jobs, fast queue: ❓ blocked by jobs, if jobs are slow enough</li>
<li>fast jobs, slow queue: ❗ blocked by queue, with enough jobs</li>
<li>fast jobs, fast queue: ✅</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>