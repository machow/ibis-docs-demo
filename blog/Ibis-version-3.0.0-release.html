<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>. – ibis-version-3.0.0-release</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">.</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../concept/why_ibis.html" rel="" target="">
 <span class="menu-text">Why Ibis?</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../tutorial/index.html" rel="" target="">
 <span class="menu-text">Ibis tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../how_to/configuration.html" rel="" target="">
 <span class="menu-text">Configure Ibis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../reference/index.html" rel="" target="">
 <span class="menu-text">Reference</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../blog/rendered/ibis-version-6.0.0-release.html" rel="" target="" aria-current="page">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../release_notes.html" rel="" target="">
 <span class="menu-text">🚧 Release notes</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../blog/Ibis-version-3.0.0-release.html">Ibis v3.0.0</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../blog/rendered/ibis-version-6.0.0-release.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ibis v6.0.0</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../blog/rendered/torch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ibis on 🔥: Supercharge Your Workflow with DuckDB and PyTorch</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../blog/rendered/campaign-finance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exploring Campaign Finance Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../blog/ibis-to-file.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ibis Sneak Peek: Writing to Files</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../blog/ibis-examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ibis Sneak Peek: Examples</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../blog/selectors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Maximizing Productivity with Selectors</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../blog/ibis_substrait_to_duckdb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ibis + Substrait + DuckDB</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../blog/ibis-version-4.0.0-release.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ibis v4.0.0</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../blog/rendered/ci-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis of Ibis’s CI Performance</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../blog/ffill-and-bfill-using-ibis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>ffill</code> and <code>bfill</code> using Ibis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../blog/Ibis-version-3.1.0-release.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ibis v3.1.0</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../blog/Ibis-version-3.0.0-release.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Ibis v3.0.0</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#ibis-v3.0.0" id="toc-ibis-v3.0.0" class="nav-link active" data-scroll-target="#ibis-v3.0.0">Ibis v3.0.0</a>
  <ul class="collapse">
  <li><a href="#new-features" id="toc-new-features" class="nav-link" data-scroll-target="#new-features">New Features</a>
  <ul class="collapse">
  <li><a href="#inline-sql" id="toc-inline-sql" class="nav-link" data-scroll-target="#inline-sql">Inline SQL</a></li>
  <li><a href="#duckdb-backend" id="toc-duckdb-backend" class="nav-link" data-scroll-target="#duckdb-backend">DuckDB Backend</a></li>
  <li><a href="#backend-support-matrix" id="toc-backend-support-matrix" class="nav-link" data-scroll-target="#backend-support-matrix">Backend Support Matrix</a></li>
  <li><a href="#support-of-arrays-and-tuples-for-clickhouse" id="toc-support-of-arrays-and-tuples-for-clickhouse" class="nav-link" data-scroll-target="#support-of-arrays-and-tuples-for-clickhouse">Support of arrays and tuples for ClickHouse</a></li>
  <li><a href="#suffixes-now-supported-in-join-api-expressions" id="toc-suffixes-now-supported-in-join-api-expressions" class="nav-link" data-scroll-target="#suffixes-now-supported-in-join-api-expressions">Suffixes now supported in join API expressions</a></li>
  <li><a href="#creating-timestamp-from-component-fields" id="toc-creating-timestamp-from-component-fields" class="nav-link" data-scroll-target="#creating-timestamp-from-component-fields">Creating timestamp from component fields</a></li>
  <li><a href="#pretty-print-tables-in-ipython-notebooks" id="toc-pretty-print-tables-in-ipython-notebooks" class="nav-link" data-scroll-target="#pretty-print-tables-in-ipython-notebooks">Pretty print tables in ipython notebooks</a></li>
  </ul></li>
  <li><a href="#other-changes" id="toc-other-changes" class="nav-link" data-scroll-target="#other-changes">Other Changes</a>
  <ul class="collapse">
  <li><a href="#the-minimum-supported-python-version-is-now-python-3.8" id="toc-the-minimum-supported-python-version-is-now-python-3.8" class="nav-link" data-scroll-target="#the-minimum-supported-python-version-is-now-python-3.8">The minimum supported Python version is now Python 3.8</a></li>
  <li><a href="#deprecation-of-.materialize" id="toc-deprecation-of-.materialize" class="nav-link" data-scroll-target="#deprecation-of-.materialize">Deprecation of .materialize()</a></li>
  </ul></li>
  <li><a href="#performance-improvements" id="toc-performance-improvements" class="nav-link" data-scroll-target="#performance-improvements">Performance Improvements</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="ibis-v3.0.0" class="level1">
<h1>Ibis v3.0.0</h1>
<p><strong>by Marlene Mhangami</strong></p>
<p>The latest version of Ibis, version 3.0.0, has just been released! This post highlights some of the new features, breaking changes, and performance improvements that come with the new release. 3.0.0 is a major release and includes more changes than those listed in this post. A full list of the changes can be found in the project release notes <a href="https://ibis-project.org/docs/dev/release_notes/">here</a>.</p>
<section id="new-features" class="level2">
<h2 class="anchored" data-anchor-id="new-features">New Features</h2>
<p>Aligned to the roadmap and in response to the community’s requests, Ibis 3.0.0 introduces many new features and functionality.</p>
<ol type="1">
<li>Now query an Ibis table using inline SQL</li>
<li><em>NEW</em> DuckDB backend</li>
<li>Explore the <em>NEW</em> backend support matrix tool</li>
<li>Improved support for arrays and tuples in ClickHouse</li>
<li>Suffixes now supported in join API expressions</li>
<li>APIs for creating timestamps and dates from component fields</li>
<li>Pretty printing in ipython/ notebooks</li>
</ol>
<p>Refer to the sections below for more detail on each new feature.</p>
<section id="inline-sql" class="level3">
<h3 class="anchored" data-anchor-id="inline-sql">Inline SQL</h3>
<p>The most exciting feature of this release is inline SQL! Many data scientists or developers may be familiar with both Python and SQL. However there may be some queries, transformations that they feel comfortable doing in SQL instead of Python. In the updated version of Ibis users can query an Ibis table using SQL! The new .sql method allows users to mix SQL strings with ibis expressions as well as query ibis table expressions in SQL strings.</p>
<p>This functionality currently works for the following backends:</p>
<ol type="1">
<li>PostgreSQL</li>
<li>DuckDB</li>
<li>PySpark</li>
<li>MySQL</li>
</ol>
<p>If you’re interested in adding .sql support for other backends please <a href="https://github.com/ibis-project/ibis/issues?page=2&amp;q=is%3Aissue+is%3Aclosed+milestone%3A3.0.0">open an issue</a>.</p>
</section>
<section id="duckdb-backend" class="level3">
<h3 class="anchored" data-anchor-id="duckdb-backend">DuckDB Backend</h3>
<p>Ibis now supports DuckDB as a backend. DuckDB is a high-performance SQL OLAP database management system. It is designed to be fast, reliable and easy to use and can be embedded. Many Ibis use cases start from getting tables from a single-node backend so directly supporting DuckDB offers a lot of value. As mentioned earlier, the DuckDB backend allows for the new .sql method on tables for mixing sql and Ibis expressions.</p>
</section>
<section id="backend-support-matrix" class="level3">
<h3 class="anchored" data-anchor-id="backend-support-matrix">Backend Support Matrix</h3>
<p>As the number of backends Ibis supports grows, it can be challenging for users to decide which one best fits their needs. One way to make a more informed decision is for users to find the backend that supports the operations they intend to use. The 3.0.0 release comes with a backend support matrix that allows users to do just that. A screenshot of part of the matrix can be seen below and the full version can be found <a href="https://ibis-project.org/docs/dev/backends/support_matrix/">here</a>.</p>
<p>In addition to this users can now call <code>ibis.${backend}.has_operation</code> to find out if a specific operation is supported by a backend.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="matrix.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">backend support matrix</figcaption>
</figure>
</div>
</section>
<section id="support-of-arrays-and-tuples-for-clickhouse" class="level3">
<h3 class="anchored" data-anchor-id="support-of-arrays-and-tuples-for-clickhouse">Support of arrays and tuples for ClickHouse</h3>
<p>The 3.0.0 release includes a slew of important improvements for the ClickHouse backend. Most prominently ibis now supports ClickHouse arrays and tuples. Some of the related operations that have been implemented are:</p>
<ul>
<li>ArrayIndex</li>
<li>ArrayConcat</li>
<li>ArrayRepeat</li>
<li>ArraySlice</li>
</ul>
<p>Other additional operations now supported for the clickhouse backend are string concat, string slicing, table union, trim, pad and string predicates (LIKE and ILIKE) and all remaining joins.</p>
</section>
<section id="suffixes-now-supported-in-join-api-expressions" class="level3">
<h3 class="anchored" data-anchor-id="suffixes-now-supported-in-join-api-expressions">Suffixes now supported in join API expressions</h3>
<p>In previous versions Ibis’ join API did not accept suffixes as a parameter, leaving backends to either use some default value or raise an error at execution time when column names overlapped. In 3.0.0 suffixes are now directly supported in the join API itself. Along with the removal of materialize, ibis now automatically adds a default suffix to any overlapping column names.</p>
</section>
<section id="creating-timestamp-from-component-fields" class="level3">
<h3 class="anchored" data-anchor-id="creating-timestamp-from-component-fields">Creating timestamp from component fields</h3>
<p>It is now possible to create timestamps directly from component fields. This is now possible using the new method <code>ibis.date(y,m,d)</code>. A user can pass in a year, month and day and the result is a datetime object. That is we can assert for example that <code>ibis.date (2022, 2, 4).type() == dt.date</code></p>
</section>
<section id="pretty-print-tables-in-ipython-notebooks" class="level3">
<h3 class="anchored" data-anchor-id="pretty-print-tables-in-ipython-notebooks">Pretty print tables in ipython notebooks</h3>
<p>For users that use jupyter notebooks, <code>repr_html</code> has been added for expressions to enable pretty printing tables in the notebook. This is currently only available for interactive mode (currently delegating to pandas implementation) and should help notebooks become more readable. An example of what this looks like can be seen below.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="repr.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">pretty print repr</figcaption>
</figure>
</div>
</section>
</section>
<section id="other-changes" class="level2">
<h2 class="anchored" data-anchor-id="other-changes">Other Changes</h2>
<p>3.0.0 is a major release and according to the project’s use of semantic versioning, breaking changes are on the table. The full list of these changes can be found <a href="https://ibis-project.org/docs/dev/release_notes/">here</a>. Some of the important changes include:</p>
<ol type="1">
<li>Python 3.8 is now the minimum supported version</li>
<li>Deprecation of <code>.materialize()</code></li>
</ol>
<p>Refer to the sections below for more detail on these changes.</p>
<section id="the-minimum-supported-python-version-is-now-python-3.8" class="level3">
<h3 class="anchored" data-anchor-id="the-minimum-supported-python-version-is-now-python-3.8">The minimum supported Python version is now Python 3.8</h3>
<p>Ibis currently follows <a href="https://numpy.org/neps/nep-0029-deprecation_policy.html">NEP 29</a>, a community policy standard that recommends Python and Numpy versions to support. NEP 29 suggests that all projects across the Scientific Python ecosystem adopt a common “time window-based” policy for support of Python and NumPy versions. Standardizing a recommendation for project support of minimum Python and NumPy versions will improve downstream project planning. As part of the 3.0.0 release, support for Python 3.7 has been dropped and the project has now adopted support for version 3.8 and higher.</p>
</section>
<section id="deprecation-of-.materialize" class="level3">
<h3 class="anchored" data-anchor-id="deprecation-of-.materialize">Deprecation of .materialize()</h3>
<p>This release sees the deprecation of the <code>.materialize()</code> method from TableExpr. In the past, the materialize method has caused a lot of confusion. Doing simple things like <code>t.join(s, t.foo == s.foo).select(["unambiguous_column"])</code> raised an exception because of it. It turns out that .materialize() isn’t necessary. The materialize method still exists, but is now a no-op and doesn’t need to be used.</p>
</section>
</section>
<section id="performance-improvements" class="level2">
<h2 class="anchored" data-anchor-id="performance-improvements">Performance Improvements</h2>
<p>The following changes to the Ibis codebase have resulted in performance improvements.</p>
<ol type="1">
<li>Speeding up <code>__str__</code> and <code>__hash__</code> datatypes</li>
<li>Creating a fast path for simple column selection (pandas/dask backends)</li>
<li>Global equality cache</li>
<li>Removing full tree repr from rule validator error message</li>
<li>Speed up attribute access</li>
<li>Using assign instead of concat in projections when possible (pandas/dask backends)</li>
</ol>
<p>Additionally, all TPC-H suite queries can be represented in Ibis. All queries are ready-to-run, using the default substitution parameters as specified by the TPC-H spec. Queries have been added <a href="https://github.com/ibis-project/tpc-queries">here</a>.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>In summary, the 3.0.0 release includes a number of new features including the ability to query an Ibis table using inline SQL, a DuckDB backend, a backend support matrix tool, support for arrays and tuples, suffixes in joins, timestamps from component fields and prettier tables in ipython. Some breaking changes to take note of are the removal of .materialize() and the switch to Python 3.8 as the minimum supported version. A wide range of changes to the code has also led to significant speed ups in 3.0.0 as well.</p>
<p>Ibis is a community led, open source project. If you’d like to contribute to the project check out the contribution guide <a href="https://ibis-project.org/docs/dev/contribute/01_environment/">here</a>. If you run into a problem and would like to submit an issue you can do so through Ibis’ <a href="https://github.com/ibis-project/ibis">Github repository</a>. Finally, Ibis relies on community support to grow and to become successful! You can help promote Ibis by following and sharing the project on <a href="https://twitter.com/IbisData">Twitter</a>, <a href="https://github.com/ibis-project/ibis">starring the repo</a> or <a href="https://ibis-project.org/docs/dev/">contributing</a> to the code. Ibis continues to improve with every release. Keep an eye on the blog for updates on the next one!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>